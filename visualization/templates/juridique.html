{% extends "base.html" %}

{% set active_page = 'juridique' %}

{% block page_title %}Conformit√© IA{% endblock %}

{% block content %}
<div class="juridique-dashboard page-transition-enter">
    <!-- Hero Section -->
    <div class="dashboard-hero">
        <div class="hero-content">
            <div class="hero-badge" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                <i data-lucide="gavel"></i>
                <span>Juridique / Conformit√©</span>
            </div>
            <h1>Conformit√© IA</h1>
            <p class="hero-subtitle">
                EU AI Act, RGPD, audit trail et documentation r√©glementaire. Pilotez votre conformit√© IA en temps r√©el.
            </p>
        </div>
        <div class="hero-actions">
            <a href="/global" class="btn btn-outline">
                <i data-lucide="globe"></i>
                <span>Vue Globale</span>
            </a>
            <button class="btn btn-primary" onclick="generateComplianceReport()">
                <i data-lucide="file-text"></i>
                <span>Rapport Conformit√©</span>
            </button>
        </div>
    </div>

    <!-- Compliance Score Overview -->
    <div class="compliance-hero-grid">
        <div class="compliance-score-card">
            <div class="score-ring" id="mainComplianceRing"></div>
            <div class="score-content">
                <span class="score-value">92%</span>
                <span class="score-label">Conformit√© Globale</span>
                <div class="score-trend trend-up">
                    <i data-lucide="trending-up"></i>
                    +5% ce mois
                </div>
            </div>
        </div>

        <div class="regulation-cards">
            <div class="regulation-card eu-ai-act">
                <div class="reg-header">
                    <span class="reg-flag">üá™üá∫</span>
                    <h3>EU AI Act</h3>
                    <span class="reg-badge in-progress">En cours</span>
                </div>
                <div class="reg-score">
                    <span class="reg-score-value">92%</span>
                    <div class="reg-progress-bar">
                        <div class="reg-progress" style="width: 92%;"></div>
                    </div>
                </div>
                <div class="reg-details">
                    <span class="reg-detail"><i data-lucide="check-circle"></i> 18 exigences valid√©es</span>
                    <span class="reg-detail"><i data-lucide="clock"></i> 2 en cours</span>
                </div>
            </div>

            <div class="regulation-card rgpd">
                <div class="reg-header">
                    <span class="reg-flag">üîí</span>
                    <h3>RGPD</h3>
                    <span class="reg-badge compliant">Conforme</span>
                </div>
                <div class="reg-score">
                    <span class="reg-score-value">98%</span>
                    <div class="reg-progress-bar">
                        <div class="reg-progress" style="width: 98%;"></div>
                    </div>
                </div>
                <div class="reg-details">
                    <span class="reg-detail"><i data-lucide="check-circle"></i> Toutes exigences valid√©es</span>
                </div>
            </div>

            <div class="regulation-card nist">
                <div class="reg-header">
                    <span class="reg-flag">üõ°Ô∏è</span>
                    <h3>NIST AI RMF</h3>
                    <span class="reg-badge in-progress">En cours</span>
                </div>
                <div class="reg-score">
                    <span class="reg-score-value">78%</span>
                    <div class="reg-progress-bar">
                        <div class="reg-progress" style="width: 78%;"></div>
                    </div>
                </div>
                <div class="reg-details">
                    <span class="reg-detail"><i data-lucide="clock"></i> 5 actions en cours</span>
                </div>
            </div>
        </div>
    </div>

    <!-- EU AI Act Focus Section -->
    <div class="section-header">
        <h2>
            <span class="section-flag">üá™üá∫</span>
            Conformit√© EU AI Act
        </h2>
        <div class="section-header-actions">
            <p>√âtat d√©taill√© de conformit√© selon les exigences du r√®glement europ√©en sur l'IA</p>
            <button class="btn btn-outline btn-sm" onclick="openComplianceDeepDive()">
                <i data-lucide="maximize-2"></i>
                Deep Dive
            </button>
        </div>
    </div>

    <div class="ai-act-grid">
        <!-- Risk Classification -->
        <div class="card card-lg">
            <div class="card-header">
                <h3>
                    <i data-lucide="layers"></i>
                    Classification des Risques
                </h3>
            </div>
            <div class="card-body">
                <div class="risk-classification">
                    <div class="risk-level high-risk">
                        <div class="risk-level-header">
                            <i data-lucide="alert-triangle"></i>
                            <span class="risk-level-name">Haut Risque</span>
                            <span class="risk-count">3 syst√®mes</span>
                        </div>
                        <div class="risk-systems">
                            <div class="risk-system">
                                <span class="system-name">Scoring Cr√©dit</span>
                                <span class="system-status compliant">Conforme</span>
                            </div>
                            <div class="risk-system">
                                <span class="system-name">KYC Automation</span>
                                <span class="system-status in-progress">En cours</span>
                            </div>
                            <div class="risk-system">
                                <span class="system-name">Fraud Detection</span>
                                <span class="system-status compliant">Conforme</span>
                            </div>
                        </div>
                    </div>

                    <div class="risk-level limited-risk">
                        <div class="risk-level-header">
                            <i data-lucide="info"></i>
                            <span class="risk-level-name">Risque Limit√©</span>
                            <span class="risk-count">8 syst√®mes</span>
                        </div>
                        <div class="risk-systems">
                            <div class="risk-system">
                                <span class="system-name">Chatbot Client</span>
                                <span class="system-status compliant">Conforme</span>
                            </div>
                            <div class="risk-system">
                                <span class="system-name">Recommendation Engine</span>
                                <span class="system-status compliant">Conforme</span>
                            </div>
                            <div class="risk-system">
                                <span class="system-name">+ 6 autres</span>
                                <span class="system-status compliant">Conforme</span>
                            </div>
                        </div>
                    </div>

                    <div class="risk-level minimal-risk">
                        <div class="risk-level-header">
                            <i data-lucide="check-circle"></i>
                            <span class="risk-level-name">Risque Minimal</span>
                            <span class="risk-count">13 syst√®mes</span>
                        </div>
                        <p class="risk-note">Aucune obligation sp√©cifique - bonnes pratiques appliqu√©es</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Requirements Checklist -->
        <div class="card card-lg">
            <div class="card-header">
                <h3>
                    <i data-lucide="clipboard-check"></i>
                    Exigences AI Act (Article 9-15)
                </h3>
            </div>
            <div class="card-body">
                <div class="requirements-list">
                    <div class="requirement-item status-passed">
                        <div class="req-status"><i data-lucide="check-circle"></i></div>
                        <div class="req-content">
                            <h4>Art. 9 - Gestion des risques</h4>
                            <p>Syst√®me de gestion des risques √©tabli et maintenu</p>
                        </div>
                        <div class="req-actions">
                            <a href="#" class="btn btn-ghost btn-sm">Documentation</a>
                        </div>
                    </div>

                    <div class="requirement-item status-passed">
                        <div class="req-status"><i data-lucide="check-circle"></i></div>
                        <div class="req-content">
                            <h4>Art. 10 - Donn√©es & gouvernance</h4>
                            <p>Qualit√© des donn√©es d'entra√Ænement v√©rifi√©e</p>
                        </div>
                        <div class="req-actions">
                            <a href="#" class="btn btn-ghost btn-sm">Documentation</a>
                        </div>
                    </div>

                    <div class="requirement-item status-in-progress">
                        <div class="req-status"><i data-lucide="clock"></i></div>
                        <div class="req-content">
                            <h4>Art. 11 - Documentation technique</h4>
                            <p>Documentation en cours de finalisation (85%)</p>
                        </div>
                        <div class="req-actions">
                            <span class="req-deadline">√âch√©ance: 15 Jan</span>
                        </div>
                    </div>

                    <div class="requirement-item status-passed">
                        <div class="req-status"><i data-lucide="check-circle"></i></div>
                        <div class="req-content">
                            <h4>Art. 12 - Tenue des registres</h4>
                            <p>Logs automatiques et audit trail en place</p>
                        </div>
                        <div class="req-actions">
                            <a href="#" class="btn btn-ghost btn-sm">Voir logs</a>
                        </div>
                    </div>

                    <div class="requirement-item status-passed">
                        <div class="req-status"><i data-lucide="check-circle"></i></div>
                        <div class="req-content">
                            <h4>Art. 13 - Transparence</h4>
                            <p>Informations utilisateurs et explicabilit√©</p>
                        </div>
                        <div class="req-actions">
                            <a href="#" class="btn btn-ghost btn-sm">Documentation</a>
                        </div>
                    </div>

                    <div class="requirement-item status-in-progress">
                        <div class="req-status"><i data-lucide="clock"></i></div>
                        <div class="req-content">
                            <h4>Art. 14 - Contr√¥le humain</h4>
                            <p>Interface de supervision en cours de d√©ploiement</p>
                        </div>
                        <div class="req-actions">
                            <span class="req-deadline">√âch√©ance: 30 Jan</span>
                        </div>
                    </div>

                    <div class="requirement-item status-passed">
                        <div class="req-status"><i data-lucide="check-circle"></i></div>
                        <div class="req-content">
                            <h4>Art. 15 - Pr√©cision & robustesse</h4>
                            <p>Tests de robustesse et pr√©cision valid√©s</p>
                        </div>
                        <div class="req-actions">
                            <a href="#" class="btn btn-ghost btn-sm">Rapports</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Audit Trail -->
        <div class="card">
            <div class="card-header">
                <h3>
                    <i data-lucide="scroll-text"></i>
                    Audit Trail
                </h3>
                <a href="#" class="btn btn-ghost btn-sm">
                    Export
                    <i data-lucide="download"></i>
                </a>
            </div>
            <div class="card-body">
                <div class="audit-timeline">
                    <div class="audit-entry">
                        <div class="audit-time">Aujourd'hui 14:32</div>
                        <div class="audit-event">
                            <span class="audit-icon update"><i data-lucide="refresh-cw"></i></span>
                            <span class="audit-text">Mise √† jour documentation technique</span>
                        </div>
                    </div>
                    <div class="audit-entry">
                        <div class="audit-time">Aujourd'hui 09:15</div>
                        <div class="audit-event">
                            <span class="audit-icon review"><i data-lucide="eye"></i></span>
                            <span class="audit-text">Revue conformit√© Art. 11 - DPO</span>
                        </div>
                    </div>
                    <div class="audit-entry">
                        <div class="audit-time">Hier 16:48</div>
                        <div class="audit-event">
                            <span class="audit-icon deploy"><i data-lucide="upload"></i></span>
                            <span class="audit-text">D√©ploiement scoring-v2.3 - Impact √©valu√©</span>
                        </div>
                    </div>
                    <div class="audit-entry">
                        <div class="audit-time">Hier 11:20</div>
                        <div class="audit-event">
                            <span class="audit-icon validation"><i data-lucide="check"></i></span>
                            <span class="audit-text">Validation AIPD - Fraud Detection</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AIPD (DPIA) Status -->
        <div class="card">
            <div class="card-header">
                <h3>
                    <i data-lucide="file-search"></i>
                    AIPD / √âtudes d'Impact
                </h3>
            </div>
            <div class="card-body">
                <div class="aipd-list">
                    <div class="aipd-item status-complete">
                        <div class="aipd-info">
                            <h4>Scoring Cr√©dit v2</h4>
                            <span class="aipd-date">Valid√©e le 15 Nov 2024</span>
                        </div>
                        <span class="aipd-status">Valid√©e</span>
                    </div>
                    <div class="aipd-item status-complete">
                        <div class="aipd-info">
                            <h4>Fraud Detection</h4>
                            <span class="aipd-date">Valid√©e le 10 Nov 2024</span>
                        </div>
                        <span class="aipd-status">Valid√©e</span>
                    </div>
                    <div class="aipd-item status-pending">
                        <div class="aipd-info">
                            <h4>KYC Automation v3</h4>
                            <span class="aipd-date">En cours de r√©vision</span>
                        </div>
                        <span class="aipd-status">En cours</span>
                    </div>
                    <div class="aipd-item status-scheduled">
                        <div class="aipd-info">
                            <h4>Chatbot LLM</h4>
                            <span class="aipd-date">Programm√©e: Jan 2025</span>
                        </div>
                        <span class="aipd-status">Planifi√©e</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upcoming Actions -->
        <div class="card">
            <div class="card-header">
                <h3>
                    <i data-lucide="calendar"></i>
                    √âch√©ances & Actions
                </h3>
            </div>
            <div class="card-body">
                <div class="actions-timeline">
                    <div class="action-item urgent">
                        <div class="action-date">
                            <span class="action-day">15</span>
                            <span class="action-month">Jan</span>
                        </div>
                        <div class="action-content">
                            <h4>Finalisation documentation Art. 11</h4>
                            <span class="action-owner">Responsable: J. Dupont</span>
                        </div>
                    </div>
                    <div class="action-item upcoming">
                        <div class="action-date">
                            <span class="action-day">30</span>
                            <span class="action-month">Jan</span>
                        </div>
                        <div class="action-content">
                            <h4>D√©ploiement interface supervision</h4>
                            <span class="action-owner">Responsable: Tech Team</span>
                        </div>
                    </div>
                    <div class="action-item upcoming">
                        <div class="action-date">
                            <span class="action-day">15</span>
                            <span class="action-month">F√©v</span>
                        </div>
                        <div class="action-content">
                            <h4>Audit externe conformit√© EU AI Act</h4>
                            <span class="action-owner">Auditeur: Deloitte</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Documentation -->
        <div class="card">
            <div class="card-header">
                <h3>
                    <i data-lucide="folder-open"></i>
                    Documentation L√©gale
                </h3>
            </div>
            <div class="card-body">
                <div class="doc-list">
                    <a href="#" class="doc-item">
                        <i data-lucide="file-text"></i>
                        <span>Registre des syst√®mes IA</span>
                        <i data-lucide="download" class="doc-action"></i>
                    </a>
                    <a href="#" class="doc-item">
                        <i data-lucide="file-text"></i>
                        <span>Documentation technique</span>
                        <i data-lucide="download" class="doc-action"></i>
                    </a>
                    <a href="#" class="doc-item">
                        <i data-lucide="file-text"></i>
                        <span>AIPD consolid√©es</span>
                        <i data-lucide="download" class="doc-action"></i>
                    </a>
                    <a href="#" class="doc-item">
                        <i data-lucide="file-text"></i>
                        <span>Politique de transparence IA</span>
                        <i data-lucide="download" class="doc-action"></i>
                    </a>
                    <a href="#" class="doc-item">
                        <i data-lucide="file-text"></i>
                        <span>Proc√©dures de contr√¥le humain</span>
                        <i data-lucide="download" class="doc-action"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Compliance Deep Dive Modal -->
<div class="modal-overlay" id="complianceDeepDiveModal">
    <div class="modal-container modal-xl">
        <div class="modal-header">
            <h2>
                <i data-lucide="scale"></i>
                Deep Dive - Conformit√© EU AI Act
            </h2>
            <button class="modal-close" onclick="closeComplianceDeepDive()">
                <i data-lucide="x"></i>
            </button>
        </div>
        <div class="modal-body">
            <!-- Overview Header -->
            <div class="deep-dive-controls">
                <div class="framework-overview-header">
                    <div class="compliance-score-large">
                        <div class="score-circle-lg">
                            <svg viewBox="0 0 100 100">
                                <defs>
                                    <linearGradient id="complianceGradientLg" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" style="stop-color:#10b981"/>
                                        <stop offset="100%" style="stop-color:#34d399"/>
                                    </linearGradient>
                                </defs>
                                <circle cx="50" cy="50" r="45" fill="none" stroke="var(--border-color)" stroke-width="6"/>
                                <circle cx="50" cy="50" r="45" fill="none" stroke="url(#complianceGradientLg)" stroke-width="6"
                                    stroke-dasharray="260" stroke-dashoffset="23" stroke-linecap="round"
                                    transform="rotate(-90 50 50)"/>
                            </svg>
                            <div class="score-value-lg">
                                <span class="grade">92%</span>
                                <span class="score">Conforme</span>
                            </div>
                        </div>
                    </div>
                    <div class="framework-meta">
                        <div class="meta-item">
                            <i data-lucide="calendar"></i>
                            <span>Derni√®re √©valuation : <strong>Aujourd'hui 14:32</strong></span>
                        </div>
                        <div class="meta-item">
                            <i data-lucide="trending-up"></i>
                            <span>Tendance : <strong class="text-success">+5% ce mois</strong></span>
                        </div>
                        <div class="meta-item">
                            <i data-lucide="target"></i>
                            <span>Objectif : <strong>95% d'ici Q1 2025</strong></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Regulation Categories -->
            <div class="deep-dive-kpis">
                <div class="deep-dive-kpi">
                    <div class="deep-dive-kpi-icon" style="background: linear-gradient(135deg, #10b981, #34d399);">
                        <i data-lucide="check-circle"></i>
                    </div>
                    <div class="deep-dive-kpi-content">
                        <span class="deep-dive-kpi-value">18/20</span>
                        <span class="deep-dive-kpi-label">Exigences valid√©es</span>
                        <span class="deep-dive-kpi-trend up"><i data-lucide="trending-up"></i> +3 ce mois</span>
                    </div>
                </div>
                <div class="deep-dive-kpi">
                    <div class="deep-dive-kpi-icon" style="background: linear-gradient(135deg, #f59e0b, #fbbf24);">
                        <i data-lucide="clock"></i>
                    </div>
                    <div class="deep-dive-kpi-content">
                        <span class="deep-dive-kpi-value">2</span>
                        <span class="deep-dive-kpi-label">En cours</span>
                        <span class="deep-dive-kpi-trend warning"><i data-lucide="alert-triangle"></i> √âch√©ance proche</span>
                    </div>
                </div>
                <div class="deep-dive-kpi">
                    <div class="deep-dive-kpi-icon" style="background: linear-gradient(135deg, #3b82f6, #60a5fa);">
                        <i data-lucide="file-text"></i>
                    </div>
                    <div class="deep-dive-kpi-content">
                        <span class="deep-dive-kpi-value">24</span>
                        <span class="deep-dive-kpi-label">Documents produits</span>
                        <span class="deep-dive-kpi-trend up"><i data-lucide="trending-up"></i> +5 ce mois</span>
                    </div>
                </div>
                <div class="deep-dive-kpi">
                    <div class="deep-dive-kpi-icon" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa);">
                        <i data-lucide="shield-check"></i>
                    </div>
                    <div class="deep-dive-kpi-content">
                        <span class="deep-dive-kpi-value">3</span>
                        <span class="deep-dive-kpi-label">Syst√®mes Haut Risque</span>
                        <span class="deep-dive-kpi-trend up"><i data-lucide="check"></i> Tous conformes</span>
                    </div>
                </div>
            </div>

            <!-- Requirements Table -->
            <div class="deep-dive-table-section">
                <h4>√âtat des exigences EU AI Act (Articles 9-15)</h4>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Article</th>
                                <th>Exigence</th>
                                <th>Statut</th>
                                <th>Progression</th>
                                <th>√âch√©ance</th>
                                <th>Responsable</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Art. 9</strong></td>
                                <td>Syst√®me de gestion des risques</td>
                                <td><span class="badge badge-success">Valid√©</span></td>
                                <td>100%</td>
                                <td>-</td>
                                <td>DPO</td>
                            </tr>
                            <tr>
                                <td><strong>Art. 10</strong></td>
                                <td>Donn√©es et gouvernance</td>
                                <td><span class="badge badge-success">Valid√©</span></td>
                                <td>100%</td>
                                <td>-</td>
                                <td>Data Team</td>
                            </tr>
                            <tr>
                                <td><strong>Art. 11</strong></td>
                                <td>Documentation technique</td>
                                <td><span class="badge badge-warning">En cours</span></td>
                                <td>85%</td>
                                <td>15 Jan 2025</td>
                                <td>J. Dupont</td>
                            </tr>
                            <tr>
                                <td><strong>Art. 12</strong></td>
                                <td>Tenue des registres</td>
                                <td><span class="badge badge-success">Valid√©</span></td>
                                <td>100%</td>
                                <td>-</td>
                                <td>IT Ops</td>
                            </tr>
                            <tr>
                                <td><strong>Art. 13</strong></td>
                                <td>Transparence et information</td>
                                <td><span class="badge badge-success">Valid√©</span></td>
                                <td>100%</td>
                                <td>-</td>
                                <td>Product</td>
                            </tr>
                            <tr>
                                <td><strong>Art. 14</strong></td>
                                <td>Contr√¥le humain</td>
                                <td><span class="badge badge-warning">En cours</span></td>
                                <td>70%</td>
                                <td>30 Jan 2025</td>
                                <td>Tech Team</td>
                            </tr>
                            <tr>
                                <td><strong>Art. 15</strong></td>
                                <td>Pr√©cision et robustesse</td>
                                <td><span class="badge badge-success">Valid√©</span></td>
                                <td>100%</td>
                                <td>-</td>
                                <td>ML Team</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Recommendations -->
            <div class="deep-dive-recommendations">
                <h4>Prochaines actions</h4>
                <div class="recommendations-list">
                    <div class="recommendation-item warning">
                        <div class="recommendation-icon">
                            <i data-lucide="alert-triangle"></i>
                        </div>
                        <div class="recommendation-content">
                            <h5>Finaliser la documentation technique (Art. 11)</h5>
                            <p>√âch√©ance dans 25 jours. Prioriser la documentation des mod√®les KYC et Scoring.</p>
                        </div>
                    </div>
                    <div class="recommendation-item">
                        <div class="recommendation-icon">
                            <i data-lucide="user-check"></i>
                        </div>
                        <div class="recommendation-content">
                            <h5>D√©ployer l'interface de supervision humaine (Art. 14)</h5>
                            <p>Interface en phase de test. Pr√©voir formation des op√©rateurs avant mise en production.</p>
                        </div>
                    </div>
                    <div class="recommendation-item">
                        <div class="recommendation-icon">
                            <i data-lucide="calendar"></i>
                        </div>
                        <div class="recommendation-content">
                            <h5>Pr√©parer l'audit externe Deloitte</h5>
                            <p>Audit pr√©vu le 15 f√©vrier 2025. Rassembler tous les documents de preuve.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeComplianceDeepDive()">Fermer</button>
            <button class="btn btn-primary" onclick="exportComplianceReport()">
                <i data-lucide="download"></i>
                Exporter le rapport
            </button>
        </div>
    </div>
</div>

<style>
/* Juridique Dashboard Styles */
.juridique-dashboard {
    padding: var(--space-6);
    max-width: 1600px;
    margin: 0 auto;
}

.dashboard-hero {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-6) 0;
    margin-bottom: var(--space-6);
}

.hero-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-2) var(--space-4);
    color: white;
    border-radius: var(--radius-full);
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: var(--space-3);
}

.hero-badge svg { width: 16px; height: 16px; }
.hero-content h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: var(--space-2); }
.hero-subtitle { font-size: 1rem; color: var(--text-secondary); max-width: 500px; }
.hero-actions { display: flex; gap: var(--space-3); }

/* Compliance Hero Grid */
.compliance-hero-grid {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: var(--space-6);
    margin-bottom: var(--space-8);
}

.compliance-score-card {
    display: flex;
    align-items: center;
    gap: var(--space-6);
    padding: var(--space-6);
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-xl);
}

.score-ring { width: 140px; height: 140px; flex-shrink: 0; }
.score-value { font-size: 3rem; font-weight: 700; color: #10b981; display: block; }
.score-label { font-size: 1rem; color: var(--text-secondary); display: block; margin-bottom: var(--space-2); }
.score-trend { display: flex; align-items: center; gap: var(--space-1); color: #10b981; font-size: 0.875rem; }
.score-trend svg { width: 16px; height: 16px; }

.regulation-cards {
    display: flex;
    gap: var(--space-4);
}

.regulation-card {
    flex: 1;
    padding: var(--space-5);
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
}

.reg-header {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    margin-bottom: var(--space-4);
}

.reg-flag { font-size: 1.5rem; }
.reg-header h3 { flex: 1; font-size: 1.125rem; }

.reg-badge {
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
    font-size: 0.6875rem;
    font-weight: 600;
    text-transform: uppercase;
}

.reg-badge.compliant { background: rgba(16, 185, 129, 0.1); color: #10b981; }
.reg-badge.in-progress { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }

.reg-score {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    margin-bottom: var(--space-3);
}

.reg-score-value { font-size: 1.5rem; font-weight: 700; }

.reg-progress-bar {
    flex: 1;
    height: 8px;
    background: var(--bg-body);
    border-radius: var(--radius-full);
    overflow: hidden;
}

.reg-progress {
    height: 100%;
    background: linear-gradient(90deg, #f59e0b, #10b981);
    border-radius: var(--radius-full);
}

.reg-details {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
}

.reg-detail {
    display: flex;
    align-items: center;
    gap: var(--space-1);
    font-size: 0.75rem;
    color: var(--text-secondary);
}

.reg-detail svg { width: 12px; height: 12px; color: #10b981; }

/* Section Header */
.section-header {
    margin-bottom: var(--space-6);
}

.section-header h2 {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    font-size: 1.5rem;
    margin-bottom: var(--space-2);
}

.section-flag { font-size: 1.5rem; }
.section-header p { color: var(--text-secondary); }

/* AI Act Grid */
.ai-act-grid {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: var(--space-5);
}

.card { grid-column: span 4; }
.card-lg { grid-column: span 6; }

/* Risk Classification */
.risk-classification {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
}

.risk-level {
    padding: var(--space-4);
    border-radius: var(--radius-md);
    border-left: 4px solid;
}

.high-risk { background: rgba(239, 68, 68, 0.05); border-color: #ef4444; }
.limited-risk { background: rgba(245, 158, 11, 0.05); border-color: #f59e0b; }
.minimal-risk { background: rgba(16, 185, 129, 0.05); border-color: #10b981; }

.risk-level-header {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    margin-bottom: var(--space-3);
}

.risk-level-header svg { width: 18px; height: 18px; }
.high-risk .risk-level-header svg { color: #ef4444; }
.limited-risk .risk-level-header svg { color: #f59e0b; }
.minimal-risk .risk-level-header svg { color: #10b981; }

.risk-level-name { flex: 1; font-weight: 600; }
.risk-count { font-size: 0.75rem; color: var(--text-secondary); }

.risk-systems {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
}

.risk-system {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-2) var(--space-3);
    background: var(--bg-card);
    border-radius: var(--radius-sm);
}

.system-name { font-size: 0.875rem; }
.system-status { font-size: 0.6875rem; padding: 2px 8px; border-radius: var(--radius-sm); }
.system-status.compliant { background: rgba(16, 185, 129, 0.1); color: #10b981; }
.system-status.in-progress { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }

.risk-note { font-size: 0.8125rem; color: var(--text-secondary); margin: 0; }

/* Requirements List */
.requirements-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
}

.requirement-item {
    display: flex;
    align-items: flex-start;
    gap: var(--space-3);
    padding: var(--space-3);
    border-radius: var(--radius-md);
    background: var(--bg-body);
}

.req-status { flex-shrink: 0; }
.req-status svg { width: 20px; height: 20px; }
.status-passed .req-status { color: #10b981; }
.status-in-progress .req-status { color: #f59e0b; }

.req-content { flex: 1; }
.req-content h4 { font-size: 0.875rem; font-weight: 600; margin-bottom: var(--space-1); }
.req-content p { font-size: 0.75rem; color: var(--text-secondary); margin: 0; }

.req-deadline {
    font-size: 0.6875rem;
    padding: var(--space-1) var(--space-2);
    background: rgba(245, 158, 11, 0.1);
    color: #f59e0b;
    border-radius: var(--radius-sm);
}

/* Audit Timeline */
.audit-timeline {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
}

.audit-entry {
    display: flex;
    align-items: center;
    gap: var(--space-3);
}

.audit-time {
    min-width: 100px;
    font-size: 0.6875rem;
    color: var(--text-secondary);
}

.audit-event {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    flex: 1;
}

.audit-icon {
    width: 28px;
    height: 28px;
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
}

.audit-icon svg { width: 14px; height: 14px; }
.audit-icon.update { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }
.audit-icon.review { background: rgba(139, 92, 246, 0.1); color: #8b5cf6; }
.audit-icon.deploy { background: rgba(16, 185, 129, 0.1); color: #10b981; }
.audit-icon.validation { background: rgba(16, 185, 129, 0.1); color: #10b981; }

.audit-text { font-size: 0.8125rem; }

/* AIPD List */
.aipd-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
}

.aipd-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-3);
    border-radius: var(--radius-md);
    background: var(--bg-body);
}

.aipd-info h4 { font-size: 0.875rem; font-weight: 500; margin-bottom: 2px; }
.aipd-date { font-size: 0.6875rem; color: var(--text-secondary); }

.aipd-status {
    font-size: 0.6875rem;
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
}

.status-complete .aipd-status { background: rgba(16, 185, 129, 0.1); color: #10b981; }
.status-pending .aipd-status { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }
.status-scheduled .aipd-status { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }

/* Actions Timeline */
.actions-timeline {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
}

.action-item {
    display: flex;
    align-items: center;
    gap: var(--space-4);
}

.action-date {
    width: 50px;
    text-align: center;
    padding: var(--space-2);
    border-radius: var(--radius-md);
    background: var(--bg-body);
}

.action-day { font-size: 1.25rem; font-weight: 700; display: block; }
.action-month { font-size: 0.6875rem; color: var(--text-secondary); text-transform: uppercase; }

.action-item.urgent .action-date { background: rgba(239, 68, 68, 0.1); color: #ef4444; }

.action-content h4 { font-size: 0.875rem; font-weight: 500; margin-bottom: 2px; }
.action-owner { font-size: 0.6875rem; color: var(--text-secondary); }

/* Doc List */
.doc-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
}

.doc-item {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-3);
    border-radius: var(--radius-md);
    background: var(--bg-body);
    text-decoration: none;
    color: var(--text-primary);
    transition: all 0.2s;
}

.doc-item:hover { background: var(--color-primary-light); }
.doc-item svg { width: 16px; height: 16px; color: var(--color-primary); }
.doc-item span { flex: 1; font-size: 0.875rem; }
.doc-action { color: var(--text-tertiary); }

/* Section Header Actions */
.section-header-actions {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.section-header-actions p {
    margin: 0;
}

/* Modal Styles */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--space-4);
    opacity: 0;
    visibility: hidden;
    transition: all var(--transition-base);
}

.modal-overlay.active {
    opacity: 1;
    visibility: visible;
}

.modal-container {
    background: var(--bg-card);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-xl);
    max-height: 90vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transform: scale(0.95) translateY(20px);
    transition: transform var(--transition-base);
}

.modal-overlay.active .modal-container {
    transform: scale(1) translateY(0);
}

.modal-xl {
    width: 100%;
    max-width: 1100px;
}

.modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-5);
    border-bottom: 1px solid var(--border-color);
}

.modal-header h2 {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    font-size: 1.25rem;
    font-weight: 600;
}

.modal-header h2 svg {
    width: 24px;
    height: 24px;
    color: var(--color-primary);
}

.modal-close {
    width: 40px;
    height: 40px;
    border: none;
    background: var(--bg-hover);
    border-radius: var(--radius-md);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-secondary);
    transition: all var(--transition-fast);
}

.modal-close:hover {
    background: var(--color-danger-light);
    color: var(--color-danger);
}

.modal-close svg { width: 20px; height: 20px; }

.modal-body {
    padding: var(--space-5);
    overflow-y: auto;
    flex: 1;
}

.modal-footer {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: var(--space-3);
    padding: var(--space-4) var(--space-5);
    border-top: 1px solid var(--border-color);
}

/* Deep Dive Styles */
.deep-dive-controls {
    margin-bottom: var(--space-5);
}

.framework-overview-header {
    display: flex;
    align-items: center;
    gap: var(--space-6);
    padding: var(--space-4);
    background: var(--bg-hover);
    border-radius: var(--radius-lg);
}

.compliance-score-large { flex-shrink: 0; }

.score-circle-lg {
    position: relative;
    width: 100px;
    height: 100px;
}

.score-circle-lg svg { width: 100%; height: 100%; }

.score-value-lg {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
}

.score-value-lg .grade {
    display: block;
    font-size: 1.5rem;
    font-weight: 700;
    color: #10b981;
    line-height: 1;
}

.score-value-lg .score {
    font-size: 0.75rem;
    color: var(--text-secondary);
}

.framework-meta {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
}

.meta-item {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.meta-item svg { width: 16px; height: 16px; }
.meta-item strong { color: var(--text-primary); }

/* Deep Dive KPIs */
.deep-dive-kpis {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--space-4);
    margin-bottom: var(--space-5);
}

.deep-dive-kpi {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-4);
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
}

.deep-dive-kpi-icon {
    width: 48px;
    height: 48px;
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.deep-dive-kpi-icon svg { width: 24px; height: 24px; color: white; }

.deep-dive-kpi-content { display: flex; flex-direction: column; }

.deep-dive-kpi-value {
    font-size: 1.5rem;
    font-weight: 700;
    line-height: 1.2;
}

.deep-dive-kpi-label {
    font-size: 0.75rem;
    color: var(--text-secondary);
}

.deep-dive-kpi-trend {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 0.6875rem;
    font-weight: 500;
    margin-top: 2px;
}

.deep-dive-kpi-trend svg { width: 12px; height: 12px; }
.deep-dive-kpi-trend.up { color: var(--color-success); }
.deep-dive-kpi-trend.warning { color: var(--color-warning); }

/* Deep Dive Table Section */
.deep-dive-table-section {
    margin-bottom: var(--space-5);
}

.deep-dive-table-section h4 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: var(--space-3);
}

/* Deep Dive Recommendations */
.deep-dive-recommendations h4 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: var(--space-3);
}

.recommendations-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
}

.recommendation-item {
    display: flex;
    align-items: flex-start;
    gap: var(--space-3);
    padding: var(--space-3);
    background: var(--bg-hover);
    border-radius: var(--radius-md);
    border-left: 3px solid var(--color-info);
}

.recommendation-item.warning { border-left-color: var(--color-warning); }

.recommendation-icon {
    width: 32px;
    height: 32px;
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-info-light);
    color: var(--color-info);
    flex-shrink: 0;
}

.recommendation-item.warning .recommendation-icon {
    background: var(--color-warning-light);
    color: var(--color-warning);
}

.recommendation-icon svg { width: 16px; height: 16px; }

.recommendation-content { flex: 1; }
.recommendation-content h5 { font-size: 0.875rem; font-weight: 600; margin-bottom: var(--space-1); }
.recommendation-content p { font-size: 0.8125rem; color: var(--text-secondary); margin: 0; }

@media (max-width: 900px) {
    .deep-dive-kpis { grid-template-columns: repeat(2, 1fr); }
}

@media (max-width: 600px) {
    .framework-overview-header { flex-direction: column; text-align: center; }
    .deep-dive-kpis { grid-template-columns: 1fr; }
}

/* Responsive */
@media (max-width: 1200px) {
    .compliance-hero-grid { grid-template-columns: 1fr; }
    .regulation-cards { flex-wrap: wrap; }
    .regulation-card { flex: 1 1 calc(50% - var(--space-2)); }
    .card-lg { grid-column: span 12; }
    .card { grid-column: span 6; }
}

@media (max-width: 768px) {
    .dashboard-hero { flex-direction: column; text-align: center; gap: var(--space-4); }
    .regulation-cards { flex-direction: column; }
    .regulation-card { flex: 1; }
    .card { grid-column: span 12; }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
    lucide.createIcons();
    initJuridiqueDashboard();
});

function initJuridiqueDashboard() {
    initComplianceRing();
}

function initComplianceRing() {
    const container = document.getElementById('mainComplianceRing');
    if (!container) return;

    container.innerHTML = `
        <svg viewBox="0 0 140 140" style="width: 100%; height: 100%;">
            <circle cx="70" cy="70" r="60" fill="none" stroke="var(--bg-body)" stroke-width="12"/>
            <circle cx="70" cy="70" r="60" fill="none" stroke="#10b981" stroke-width="12"
                    stroke-dasharray="346 377" stroke-linecap="round" transform="rotate(-90 70 70)">
                <animate attributeName="stroke-dasharray" from="0 377" to="346 377" dur="1s" fill="freeze"/>
            </circle>
        </svg>
    `;
}

function generateComplianceReport() {
    showToast('G√©n√©ration du rapport de conformit√© en cours...', 'info', 3000);
}

// Compliance Deep Dive Modal
function openComplianceDeepDive() {
    const modal = document.getElementById('complianceDeepDiveModal');
    if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
        lucide.createIcons();
    }
}

function closeComplianceDeepDive() {
    const modal = document.getElementById('complianceDeepDiveModal');
    if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
    }
}

function exportComplianceReport() {
    showToast('Export du rapport de conformit√© en cours...', 'info', 3000);
    setTimeout(() => {
        showToast('Rapport export√© avec succ√®s', 'success', 3000);
    }, 1500);
}

// Close modal on escape key
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        closeComplianceDeepDive();
    }
});

// Close modal on overlay click
document.addEventListener('click', (e) => {
    if (e.target.classList.contains('modal-overlay')) {
        closeComplianceDeepDive();
    }
});
</script>
{% endblock %}
