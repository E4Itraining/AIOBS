{% extends "base.html" %}

{% set active_page = 'onboarding' %}

{% block page_title %}{{ t('onboarding.title') or 'Welcome to AIOBS' }}{% endblock %}

{% block page_subtitle %}
<p>{{ t('onboarding.subtitle') or 'Choose your profile to get started' }}</p>
{% endblock %}

{% block content %}
<!-- Onboarding Welcome -->
<div class="onboarding-container">
    <!-- Step 1: Welcome -->
    <div class="onboarding-step active" id="step-welcome">
        <div class="onboarding-hero">
            <div class="hero-icon">
                <i data-lucide="shield-check"></i>
            </div>
            <h1>{{ t('onboarding.welcome_title') or 'Welcome to AIOBS' }}</h1>
            <p class="hero-subtitle">{{ t('onboarding.welcome_subtitle') or 'AI Trust Control Layer - Your unified observability platform for AI systems' }}</p>
        </div>

        <div class="onboarding-features">
            <div class="feature-card">
                <i data-lucide="eye"></i>
                <h3>{{ t('onboarding.feature_observe') or 'Observe' }}</h3>
                <p>{{ t('onboarding.feature_observe_desc') or 'Monitor your AI models in real-time with comprehensive metrics' }}</p>
            </div>
            <div class="feature-card">
                <i data-lucide="git-branch"></i>
                <h3>{{ t('onboarding.feature_understand') or 'Understand' }}</h3>
                <p>{{ t('onboarding.feature_understand_desc') or 'Analyze root causes with causal graphs and impact analysis' }}</p>
            </div>
            <div class="feature-card">
                <i data-lucide="shield"></i>
                <h3>{{ t('onboarding.feature_trust') or 'Trust' }}</h3>
                <p>{{ t('onboarding.feature_trust_desc') or 'Ensure compliance and reliability with cognitive metrics' }}</p>
            </div>
        </div>

        <button class="btn btn-primary btn-lg" onclick="nextStep('profile')">
            {{ t('onboarding.get_started') or 'Get Started' }}
            <i data-lucide="arrow-right"></i>
        </button>
    </div>

    <!-- Step 2: Profile Selection -->
    <div class="onboarding-step" id="step-profile">
        <div class="step-header">
            <button class="btn btn-ghost" onclick="prevStep('welcome')">
                <i data-lucide="arrow-left"></i>
                {{ t('actions.back') or 'Back' }}
            </button>
            <div class="step-indicator">
                <span class="step-dot"></span>
                <span class="step-dot active"></span>
                <span class="step-dot"></span>
            </div>
        </div>

        <h2>{{ t('onboarding.who_are_you') or 'Who are you?' }}</h2>
        <p class="step-desc">{{ t('onboarding.profile_desc') or 'Select your role to get a personalized experience tailored to your needs.' }}</p>

        <!-- Profile Categories -->
        <div class="profile-categories">
            <!-- Technical Profiles -->
            <div class="profile-category">
                <div class="category-header">
                    <span class="category-badge tech">{{ t('onboarding.category_tech') or 'Technical' }}</span>
                    <p class="category-desc">{{ t('onboarding.category_tech_desc') or 'For engineers and data professionals' }}</p>
                </div>
                <div class="profile-grid">
                    <div class="profile-card" data-profile="tech_ml_engineer" onclick="selectProfile(this)">
                        <div class="profile-icon">
                            <i data-lucide="cpu"></i>
                        </div>
                        <h4>{{ t('profiles.ml_engineer') or 'ML Engineer' }}</h4>
                        <p>{{ t('onboarding.ml_engineer_desc') or 'Model health, multi-drift detection, cognitive metrics, reliability analysis, and causal root cause investigation' }}</p>
                        <div class="profile-focus">
                            <span class="tag">Trust Score</span>
                            <span class="tag">Drift</span>
                            <span class="tag">Cognitive</span>
                            <span class="tag">Causal</span>
                        </div>
                    </div>

                    <div class="profile-card" data-profile="tech_devops" onclick="selectProfile(this)">
                        <div class="profile-icon">
                            <i data-lucide="server"></i>
                        </div>
                        <h4>{{ t('profiles.devops') or 'DevOps Engineer' }}</h4>
                        <p>{{ t('onboarding.devops_desc') or 'SLO/SLI monitoring, service topology, performance metrics, alerts management, and deployment tracking' }}</p>
                        <div class="profile-focus">
                            <span class="tag">SLO/SLI</span>
                            <span class="tag">Topology</span>
                            <span class="tag">Latency</span>
                            <span class="tag">Deploys</span>
                        </div>
                    </div>

                    <div class="profile-card" data-profile="tech_data_scientist" onclick="selectProfile(this)">
                        <div class="profile-icon">
                            <i data-lucide="bar-chart-2"></i>
                        </div>
                        <h4>{{ t('profiles.data_scientist') or 'Data Scientist' }}</h4>
                        <p>{{ t('onboarding.data_scientist_desc') or 'Data quality monitoring, feature analysis, A/B experiments, statistical insights, and model comparison' }}</p>
                        <div class="profile-focus">
                            <span class="tag">Data Quality</span>
                            <span class="tag">Features</span>
                            <span class="tag">Experiments</span>
                            <span class="tag">Stats</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Business Profiles -->
            <div class="profile-category">
                <div class="category-header">
                    <span class="category-badge business">{{ t('onboarding.category_business') or 'Business' }}</span>
                    <p class="category-desc">{{ t('onboarding.category_business_desc') or 'For executives and product leaders' }}</p>
                </div>
                <div class="profile-grid">
                    <div class="profile-card" data-profile="business_executive" onclick="selectProfile(this)">
                        <div class="profile-icon">
                            <i data-lucide="briefcase"></i>
                        </div>
                        <h4>{{ t('profiles.executive') or 'Executive' }}</h4>
                        <p>{{ t('onboarding.executive_desc') or 'High-level KPIs, business impact, strategic overview' }}</p>
                        <div class="profile-focus">
                            <span class="tag">KPIs</span>
                            <span class="tag">ROI</span>
                            <span class="tag">Impact</span>
                        </div>
                    </div>

                    <div class="profile-card" data-profile="business_product" onclick="selectProfile(this)">
                        <div class="profile-icon">
                            <i data-lucide="package"></i>
                        </div>
                        <h4>{{ t('profiles.product_owner') or 'Product Owner' }}</h4>
                        <p>{{ t('onboarding.product_owner_desc') or 'AI features portfolio, user experience metrics, adoption funnels, A/B tests, and business impact tracking' }}</p>
                        <div class="profile-focus">
                            <span class="tag">Features</span>
                            <span class="tag">UX Impact</span>
                            <span class="tag">Adoption</span>
                            <span class="tag">Revenue</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Specialist Profiles -->
            <div class="profile-category">
                <div class="category-header">
                    <span class="category-badge specialist">{{ t('onboarding.category_specialist') or 'Specialist' }}</span>
                    <p class="category-desc">{{ t('onboarding.category_specialist_desc') or 'For security, compliance and sustainability' }}</p>
                </div>
                <div class="profile-grid">
                    <div class="profile-card" data-profile="security_soc" onclick="selectProfile(this)">
                        <div class="profile-icon">
                            <i data-lucide="shield-alert"></i>
                        </div>
                        <h4>{{ t('profiles.security') or 'Security Analyst' }}</h4>
                        <p>{{ t('onboarding.security_desc') or 'Security posture, threats, incident management' }}</p>
                        <div class="profile-focus">
                            <span class="tag">Threats</span>
                            <span class="tag">Incidents</span>
                        </div>
                    </div>

                    <div class="profile-card" data-profile="compliance_legal" onclick="selectProfile(this)">
                        <div class="profile-icon">
                            <i data-lucide="check-square"></i>
                        </div>
                        <h4>{{ t('profiles.compliance') or 'Compliance Officer' }}</h4>
                        <p>{{ t('onboarding.compliance_desc') or 'Regulatory compliance, audit trails, governance' }}</p>
                        <div class="profile-focus">
                            <span class="tag">Audit</span>
                            <span class="tag">GDPR</span>
                            <span class="tag">AI Act</span>
                        </div>
                    </div>

                    <div class="profile-card" data-profile="sustainability_esg" onclick="selectProfile(this)">
                        <div class="profile-icon">
                            <i data-lucide="leaf"></i>
                        </div>
                        <h4>{{ t('profiles.esg') or 'ESG Manager' }}</h4>
                        <p>{{ t('onboarding.esg_desc') or 'Carbon footprint, energy, sustainability metrics' }}</p>
                        <div class="profile-focus">
                            <span class="tag">Carbon</span>
                            <span class="tag">Energy</span>
                            <span class="tag">ESG</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Governance Profiles (DSI, RSI) -->
            <div class="profile-category">
                <div class="category-header">
                    <span class="category-badge governance">{{ t('onboarding.category_governance') or 'Governance' }}</span>
                    <p class="category-desc">{{ t('onboarding.category_governance_desc') or 'For IT directors and managers' }}</p>
                </div>
                <div class="profile-grid">
                    <div class="profile-card" data-profile="governance_dsi" onclick="selectProfile(this)">
                        <div class="profile-icon">
                            <i data-lucide="landmark"></i>
                        </div>
                        <h4>{{ t('profiles.dsi') or 'CIO / DSI' }}</h4>
                        <p>{{ t('onboarding.dsi_desc') or 'Strategic IT governance, AI portfolio, budget, transformation' }}</p>
                        <div class="profile-focus">
                            <span class="tag">Portfolio</span>
                            <span class="tag">Budget</span>
                            <span class="tag">Strategy</span>
                        </div>
                    </div>

                    <div class="profile-card" data-profile="governance_rsi" onclick="selectProfile(this)">
                        <div class="profile-icon">
                            <i data-lucide="settings"></i>
                        </div>
                        <h4>{{ t('profiles.rsi') or 'IT Manager / RSI' }}</h4>
                        <p>{{ t('onboarding.rsi_desc') or 'Operational IT management, systems, projects, resources' }}</p>
                        <div class="profile-focus">
                            <span class="tag">Systems</span>
                            <span class="tag">Projects</span>
                            <span class="tag">Teams</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Legal & Privacy Profiles (DPO, Legal) -->
            <div class="profile-category">
                <div class="category-header">
                    <span class="category-badge legal">{{ t('onboarding.category_legal') or 'Legal & Privacy' }}</span>
                    <p class="category-desc">{{ t('onboarding.category_legal_desc') or 'For DPO and legal professionals' }}</p>
                </div>
                <div class="profile-grid">
                    <div class="profile-card" data-profile="privacy_dpo" onclick="selectProfile(this)">
                        <div class="profile-icon">
                            <i data-lucide="user-check"></i>
                        </div>
                        <h4>{{ t('profiles.dpo') or 'Data Protection Officer' }}</h4>
                        <p>{{ t('onboarding.dpo_desc') or 'GDPR compliance, data processing registry, DPIA, data rights' }}</p>
                        <div class="profile-focus">
                            <span class="tag">GDPR</span>
                            <span class="tag">DPIA</span>
                            <span class="tag">Rights</span>
                        </div>
                    </div>

                    <div class="profile-card" data-profile="legal_counsel" onclick="selectProfile(this)">
                        <div class="profile-icon">
                            <i data-lucide="scale"></i>
                        </div>
                        <h4>{{ t('profiles.legal') or 'Legal Counsel' }}</h4>
                        <p>{{ t('onboarding.legal_desc') or 'Legal risk assessment, contracts, regulatory watch, IP' }}</p>
                        <div class="profile-focus">
                            <span class="tag">Contracts</span>
                            <span class="tag">AI Act</span>
                            <span class="tag">IP</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <button class="btn btn-primary btn-lg" id="profileContinueBtn" disabled onclick="nextStep('tour')">
            {{ t('onboarding.continue') or 'Continue' }}
            <i data-lucide="arrow-right"></i>
        </button>
    </div>

    <!-- Step 3: Quick Tour -->
    <div class="onboarding-step" id="step-tour">
        <div class="step-header">
            <button class="btn btn-ghost" onclick="prevStep('profile')">
                <i data-lucide="arrow-left"></i>
                {{ t('actions.back') or 'Back' }}
            </button>
            <div class="step-indicator">
                <span class="step-dot"></span>
                <span class="step-dot"></span>
                <span class="step-dot active"></span>
            </div>
        </div>

        <h2>{{ t('onboarding.quick_tour') or 'Quick Tour' }}</h2>
        <p class="step-desc" id="tourDesc">{{ t('onboarding.tour_desc') or 'Here is what you can do with AIOBS based on your role.' }}</p>

        <!-- Tour content will be populated based on profile -->
        <div class="tour-content" id="tourContent">
            <!-- Dynamic content based on selected profile -->
        </div>

        <div class="tour-actions">
            <button class="btn btn-secondary" onclick="skipTour()">
                <i data-lucide="skip-forward"></i>
                {{ t('onboarding.skip_tour') or 'Skip tour' }}
            </button>
            <button class="btn btn-primary btn-lg" onclick="startDashboard()">
                {{ t('onboarding.start_dashboard') or 'Go to Dashboard' }}
                <i data-lucide="arrow-right"></i>
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let selectedProfile = null;

// Tour content per profile
const tourContent = {
    tech_ml_engineer: {
        title: '{{ t("onboarding.tour_ml_title") or "ML Engineer Dashboard" }}',
        description: '{{ t("onboarding.tour_ml_desc") or "Your comprehensive workspace for AI model observability, reliability, and performance optimization" }}',
        features: [
            { icon: 'gauge', title: '{{ t("onboarding.tour_ml_1_title") or "Trust Score & Model Health" }}', desc: '{{ t("onboarding.tour_ml_1_desc") or "Track model reliability with real-time trust scores, confidence intervals, and health indicators at a glance" }}' },
            { icon: 'activity', title: '{{ t("onboarding.tour_ml_2_title") or "Multi-Drift Detection" }}', desc: '{{ t("onboarding.tour_ml_2_desc") or "Detect data drift, concept drift, and feature drift before they impact your users - with anomaly highlighting" }}' },
            { icon: 'git-branch', title: '{{ t("onboarding.tour_ml_3_title") or "Causal Analysis" }}', desc: '{{ t("onboarding.tour_ml_3_desc") or "Understand root causes with interactive causal graphs and impact visualization" }}' },
            { icon: 'brain', title: '{{ t("onboarding.tour_ml_4_title") or "Cognitive Metrics" }}', desc: '{{ t("onboarding.tour_ml_4_desc") or "Monitor hallucination risk, confidence calibration, uncertainty quantification, and out-of-distribution detection" }}' },
            { icon: 'radar', title: '{{ t("onboarding.tour_ml_5_title") or "Reliability Radar" }}', desc: '{{ t("onboarding.tour_ml_5_desc") or "Visualize calibration, stability, uncertainty, OOD detection, and robustness in one radar chart" }}' },
            { icon: 'flask', title: '{{ t("onboarding.tour_ml_6_title") or "Experiments & Deployments" }}', desc: '{{ t("onboarding.tour_ml_6_desc") or "Track recent experiments, A/B tests, and model deployments with timeline visualization" }}' }
        ]
    },
    tech_devops: {
        title: '{{ t("onboarding.tour_devops_title") or "DevOps Engineer Dashboard" }}',
        description: '{{ t("onboarding.tour_devops_desc") or "Infrastructure monitoring, SLO management, and operational excellence for AI systems" }}',
        features: [
            { icon: 'target', title: '{{ t("onboarding.tour_devops_1_title") or "SLO/SLI Monitoring" }}', desc: '{{ t("onboarding.tour_devops_1_desc") or "Track service level objectives with real-time compliance status, error budgets, and trend indicators" }}' },
            { icon: 'share-2', title: '{{ t("onboarding.tour_devops_2_title") or "Service Topology" }}', desc: '{{ t("onboarding.tour_devops_2_desc") or "Visualize service dependencies, identify bottlenecks, and see latency across the topology" }}' },
            { icon: 'bell', title: '{{ t("onboarding.tour_devops_3_title") or "Alerts & Incidents" }}', desc: '{{ t("onboarding.tour_devops_3_desc") or "Get actionable alerts with root cause context and manage active incidents efficiently" }}' },
            { icon: 'activity', title: '{{ t("onboarding.tour_devops_4_title") or "Performance Metrics" }}', desc: '{{ t("onboarding.tour_devops_4_desc") or "Monitor latency percentiles (P50, P95, P99), throughput, and error rates with anomaly detection" }}' },
            { icon: 'server', title: '{{ t("onboarding.tour_devops_5_title") or "Services Health" }}', desc: '{{ t("onboarding.tour_devops_5_desc") or "Track all services status, uptime, error rates, and deployment information in one view" }}' },
            { icon: 'git-pull-request', title: '{{ t("onboarding.tour_devops_6_title") or "Deployment History" }}', desc: '{{ t("onboarding.tour_devops_6_desc") or "View recent deployments, rollbacks, and release status in a timeline view" }}' }
        ]
    },
    business_executive: {
        title: '{{ t("onboarding.tour_exec_title") or "Executive Dashboard" }}',
        description: '{{ t("onboarding.tour_exec_desc") or "Strategic overview of AI operations" }}',
        features: [
            { icon: 'trending-up', title: '{{ t("onboarding.tour_exec_1_title") or "Business Impact" }}', desc: '{{ t("onboarding.tour_exec_1_desc") or "See how AI performance affects business metrics" }}' },
            { icon: 'dollar-sign', title: '{{ t("onboarding.tour_exec_2_title") or "Cost Overview" }}', desc: '{{ t("onboarding.tour_exec_2_desc") or "Track AI spending with clear cost breakdowns" }}' },
            { icon: 'shield-check', title: '{{ t("onboarding.tour_exec_3_title") or "Trust & Compliance" }}', desc: '{{ t("onboarding.tour_exec_3_desc") or "One-glance view of system reliability and compliance" }}' },
            { icon: 'bar-chart', title: '{{ t("onboarding.tour_exec_4_title") or "Key Metrics" }}', desc: '{{ t("onboarding.tour_exec_4_desc") or "Essential KPIs without technical complexity" }}' }
        ]
    },
    business_product: {
        title: '{{ t("onboarding.tour_product_title") or "Product Owner Dashboard" }}',
        description: '{{ t("onboarding.tour_product_desc") or "AI features portfolio, user experience metrics, and business impact tracking" }}',
        features: [
            { icon: 'grid', title: '{{ t("onboarding.tour_product_1_title") or "AI Features Portfolio" }}', desc: '{{ t("onboarding.tour_product_1_desc") or "Track all AI features with usage, satisfaction, and reliability metrics in one view" }}' },
            { icon: 'users', title: '{{ t("onboarding.tour_product_2_title") or "User Experience Impact" }}', desc: '{{ t("onboarding.tour_product_2_desc") or "Understand how AI features affect user experience and satisfaction scores" }}' },
            { icon: 'trending-up', title: '{{ t("onboarding.tour_product_3_title") or "Conversion & Revenue" }}', desc: '{{ t("onboarding.tour_product_3_desc") or "Measure AI contribution to conversion rates, revenue, and business goals with baseline comparison" }}' },
            { icon: 'filter', title: '{{ t("onboarding.tour_product_4_title") or "Adoption Funnel" }}', desc: '{{ t("onboarding.tour_product_4_desc") or "Track feature adoption from exposure through engagement to retention" }}' },
            { icon: 'flask', title: '{{ t("onboarding.tour_product_5_title") or "A/B Test Results" }}', desc: '{{ t("onboarding.tour_product_5_desc") or "View experiment results with lift, confidence levels, and winning variants" }}' },
            { icon: 'heart', title: '{{ t("onboarding.tour_product_6_title") or "Satisfaction Trends" }}', desc: '{{ t("onboarding.tour_product_6_desc") or "Monitor user satisfaction and NPS score trends over time" }}' }
        ]
    },
    security_soc: {
        title: '{{ t("onboarding.tour_security_title") or "Security Dashboard" }}',
        description: '{{ t("onboarding.tour_security_desc") or "AI security and threat management" }}',
        features: [
            { icon: 'shield', title: '{{ t("onboarding.tour_security_1_title") or "Security Posture" }}', desc: '{{ t("onboarding.tour_security_1_desc") or "Overall security health with actionable insights" }}' },
            { icon: 'alert-triangle', title: '{{ t("onboarding.tour_security_2_title") or "Threat Detection" }}', desc: '{{ t("onboarding.tour_security_2_desc") or "Real-time threat timeline and incident tracking" }}' },
            { icon: 'key', title: '{{ t("onboarding.tour_security_3_title") or "Access Monitoring" }}', desc: '{{ t("onboarding.tour_security_3_desc") or "Track and audit model access patterns" }}' }
        ]
    },
    compliance_legal: {
        title: '{{ t("onboarding.tour_compliance_title") or "Compliance Dashboard" }}',
        description: '{{ t("onboarding.tour_compliance_desc") or "Governance and regulatory compliance" }}',
        features: [
            { icon: 'check-square', title: '{{ t("onboarding.tour_compliance_1_title") or "Compliance Status" }}', desc: '{{ t("onboarding.tour_compliance_1_desc") or "Track compliance across all regulations (GDPR, AI Act, etc.)" }}' },
            { icon: 'clipboard', title: '{{ t("onboarding.tour_compliance_2_title") or "Audit Trail" }}', desc: '{{ t("onboarding.tour_compliance_2_desc") or "Complete audit history with evidence management" }}' },
            { icon: 'file-text', title: '{{ t("onboarding.tour_compliance_3_title") or "Reports" }}', desc: '{{ t("onboarding.tour_compliance_3_desc") or "Generate compliance reports for stakeholders" }}' }
        ]
    },
    sustainability_esg: {
        title: '{{ t("onboarding.tour_esg_title") or "Sustainability Dashboard" }}',
        description: '{{ t("onboarding.tour_esg_desc") or "Environmental impact of AI operations" }}',
        features: [
            { icon: 'cloud', title: '{{ t("onboarding.tour_esg_1_title") or "Carbon Tracking" }}', desc: '{{ t("onboarding.tour_esg_1_desc") or "Monitor carbon emissions from AI inference and training" }}' },
            { icon: 'zap', title: '{{ t("onboarding.tour_esg_2_title") or "Energy Consumption" }}', desc: '{{ t("onboarding.tour_esg_2_desc") or "Track energy usage with green energy percentage" }}' },
            { icon: 'lightbulb', title: '{{ t("onboarding.tour_esg_3_title") or "Recommendations" }}', desc: '{{ t("onboarding.tour_esg_3_desc") or "Get actionable tips to reduce environmental impact" }}' }
        ]
    },
    tech_data_scientist: {
        title: '{{ t("onboarding.tour_ds_title") or "Data Scientist Dashboard" }}',
        description: '{{ t("onboarding.tour_ds_desc") or "Data quality monitoring, experiment tracking, statistical analysis, and model comparison" }}',
        features: [
            { icon: 'database', title: '{{ t("onboarding.tour_ds_1_title") or "Data Quality Metrics" }}', desc: '{{ t("onboarding.tour_ds_1_desc") or "Monitor completeness, accuracy, freshness, consistency, uniqueness, and validity with trend visualization" }}' },
            { icon: 'grid', title: '{{ t("onboarding.tour_ds_2_title") or "Feature Drift Heatmap" }}', desc: '{{ t("onboarding.tour_ds_2_desc") or "Visualize feature drift across all features with color-coded severity indicators" }}' },
            { icon: 'bar-chart-2', title: '{{ t("onboarding.tour_ds_3_title") or "Feature Importance" }}', desc: '{{ t("onboarding.tour_ds_3_desc") or "See which features drive model predictions with ranked importance charts" }}' },
            { icon: 'flask', title: '{{ t("onboarding.tour_ds_4_title") or "Experiments & A/B Tests" }}', desc: '{{ t("onboarding.tour_ds_4_desc") or "Track experiment results with p-values, effect sizes, and winning variants" }}' },
            { icon: 'pie-chart', title: '{{ t("onboarding.tour_ds_5_title") or "Statistical Insights" }}', desc: '{{ t("onboarding.tour_ds_5_desc") or "Deep statistical analysis with confidence intervals and hypothesis testing" }}' },
            { icon: 'git-compare', title: '{{ t("onboarding.tour_ds_6_title") or "Model Comparison" }}', desc: '{{ t("onboarding.tour_ds_6_desc") or "Compare model performance across accuracy, precision, recall, F1, latency, and cost" }}' }
        ]
    },
    governance_dsi: {
        title: '{{ t("onboarding.tour_dsi_title") or "DSI / CIO Dashboard" }}',
        description: '{{ t("onboarding.tour_dsi_desc") or "Strategic IT governance and AI portfolio management" }}',
        features: [
            { icon: 'grid', title: '{{ t("onboarding.tour_dsi_1_title") or "AI Portfolio" }}', desc: '{{ t("onboarding.tour_dsi_1_desc") or "Overview of all AI systems with strategic metrics" }}' },
            { icon: 'wallet', title: '{{ t("onboarding.tour_dsi_2_title") or "Budget Allocation" }}', desc: '{{ t("onboarding.tour_dsi_2_desc") or "Track IT spending and ROI across AI initiatives" }}' },
            { icon: 'alert-triangle', title: '{{ t("onboarding.tour_dsi_3_title") or "Risk Matrix" }}', desc: '{{ t("onboarding.tour_dsi_3_desc") or "Identify and manage IT risks with impact analysis" }}' },
            { icon: 'refresh-cw', title: '{{ t("onboarding.tour_dsi_4_title") or "Digital Transformation" }}', desc: '{{ t("onboarding.tour_dsi_4_desc") or "Track transformation roadmap and maturity" }}' }
        ]
    },
    governance_rsi: {
        title: '{{ t("onboarding.tour_rsi_title") or "RSI / IT Manager Dashboard" }}',
        description: '{{ t("onboarding.tour_rsi_desc") or "Operational IT management and team coordination" }}',
        features: [
            { icon: 'server', title: '{{ t("onboarding.tour_rsi_1_title") or "Systems Status" }}', desc: '{{ t("onboarding.tour_rsi_1_desc") or "Real-time health monitoring of all AI systems" }}' },
            { icon: 'folder-kanban', title: '{{ t("onboarding.tour_rsi_2_title") or "Projects Tracker" }}', desc: '{{ t("onboarding.tour_rsi_2_desc") or "Manage AI projects with kanban-style tracking" }}' },
            { icon: 'alert-circle', title: '{{ t("onboarding.tour_rsi_3_title") or "Incidents Management" }}', desc: '{{ t("onboarding.tour_rsi_3_desc") or "Track and resolve operational incidents" }}' }
        ]
    },
    privacy_dpo: {
        title: '{{ t("onboarding.tour_dpo_title") or "DPO Dashboard" }}',
        description: '{{ t("onboarding.tour_dpo_desc") or "Data protection and GDPR compliance" }}',
        features: [
            { icon: 'database', title: '{{ t("onboarding.tour_dpo_1_title") or "Processing Registry" }}', desc: '{{ t("onboarding.tour_dpo_1_desc") or "Complete registry of AI data processing activities" }}' },
            { icon: 'file-search', title: '{{ t("onboarding.tour_dpo_2_title") or "DPIA Management" }}', desc: '{{ t("onboarding.tour_dpo_2_desc") or "Track and manage Data Protection Impact Assessments" }}' },
            { icon: 'user-check', title: '{{ t("onboarding.tour_dpo_3_title") or "Data Subject Requests" }}', desc: '{{ t("onboarding.tour_dpo_3_desc") or "Manage GDPR rights requests with deadline tracking" }}' },
            { icon: 'share-2', title: '{{ t("onboarding.tour_dpo_4_title") or "Data Flows" }}', desc: '{{ t("onboarding.tour_dpo_4_desc") or "Visualize personal data flows and transfers" }}' }
        ]
    },
    legal_counsel: {
        title: '{{ t("onboarding.tour_legal_title") or "Legal Counsel Dashboard" }}',
        description: '{{ t("onboarding.tour_legal_desc") or "Legal risk management and compliance" }}',
        features: [
            { icon: 'scale', title: '{{ t("onboarding.tour_legal_1_title") or "Legal Risk Assessment" }}', desc: '{{ t("onboarding.tour_legal_1_desc") or "Evaluate AI legal risks: bias, liability, IP" }}' },
            { icon: 'book-open', title: '{{ t("onboarding.tour_legal_2_title") or "Regulatory Watch" }}', desc: '{{ t("onboarding.tour_legal_2_desc") or "Stay updated on EU AI Act and regulations" }}' },
            { icon: 'file-signature', title: '{{ t("onboarding.tour_legal_3_title") or "Contracts Management" }}', desc: '{{ t("onboarding.tour_legal_3_desc") or "Track AI contracts, SLAs, and compliance" }}' }
        ]
    }
};

function nextStep(step) {
    document.querySelectorAll('.onboarding-step').forEach(s => s.classList.remove('active'));
    document.getElementById('step-' + step).classList.add('active');

    if (step === 'tour' && selectedProfile) {
        renderTourContent();
    }

    lucide.createIcons();
}

function prevStep(step) {
    document.querySelectorAll('.onboarding-step').forEach(s => s.classList.remove('active'));
    document.getElementById('step-' + step).classList.add('active');
    lucide.createIcons();
}

function selectProfile(card) {
    // Remove selection from all cards
    document.querySelectorAll('.profile-card').forEach(c => c.classList.remove('selected'));

    // Select this card
    card.classList.add('selected');
    selectedProfile = card.dataset.profile;

    // Enable continue button
    document.getElementById('profileContinueBtn').disabled = false;

    // Store profile in localStorage
    localStorage.setItem('aiobs-user-profile', selectedProfile);
}

function renderTourContent() {
    const content = tourContent[selectedProfile];
    if (!content) return;

    const container = document.getElementById('tourContent');
    container.innerHTML = `
        <div class="tour-header">
            <h3>${content.title}</h3>
            <p>${content.description}</p>
        </div>
        <div class="tour-features">
            ${content.features.map(f => `
                <div class="tour-feature">
                    <div class="tour-feature-icon">
                        <i data-lucide="${f.icon}"></i>
                    </div>
                    <div class="tour-feature-content">
                        <h4>${f.title}</h4>
                        <p>${f.desc}</p>
                    </div>
                </div>
            `).join('')}
        </div>
    `;
    lucide.createIcons();
}

function skipTour() {
    startDashboard();
}

function startDashboard() {
    // Mark onboarding as complete
    localStorage.setItem('aiobs-onboarding-complete', 'true');

    // Redirect to profile-specific dashboard
    if (selectedProfile) {
        window.location.href = '/profile/' + selectedProfile;
    } else {
        window.location.href = '/';
    }
}

// Check if onboarding is already complete
document.addEventListener('DOMContentLoaded', () => {
    const savedProfile = localStorage.getItem('aiobs-user-profile');
    if (savedProfile) {
        const card = document.querySelector(`[data-profile="${savedProfile}"]`);
        if (card) {
            selectProfile(card);
        }
    }
    lucide.createIcons();
});
</script>
{% endblock %}
