{% extends "base.html" %}

{% block page_title %}Choisir mon Parcours{% endblock %}

{% block content %}
<div class="welcome-hub page-transition-enter">
    <!-- Hero Section - Simplified -->
    <div class="welcome-hero">
        <div class="hero-content">
            <div class="hero-logo">
                <i data-lucide="eye"></i>
            </div>
            <h1>Quel est votre rôle ?</h1>
            <p class="hero-subtitle">
                GASKIA adapte son interface à vos besoins.
                <span class="hero-hint">Modifiable à tout moment.</span>
            </p>
        </div>
    </div>

    <!-- Persona Categories -->
    <div class="persona-categories">
        <!-- Strategic / Business -->
        <div class="persona-category">
            <div class="category-header">
                <span class="category-badge business">
                    <i data-lucide="briefcase"></i>
                    Stratégie & Finance
                </span>
            </div>
            <div class="persona-row">
                <div class="persona-tile" data-persona="business_executive" onclick="selectPersona('business_executive')">
                    <div class="tile-icon tile-icon-business">
                        <i data-lucide="building-2"></i>
                    </div>
                    <div class="tile-content">
                        <h3>Dirigeant / CDO</h3>
                        <p>ROI, risques, conformité</p>
                    </div>
                    <i data-lucide="chevron-right" class="tile-arrow"></i>
                </div>
                <div class="persona-tile" data-persona="financier" onclick="selectPersona('financier')">
                    <div class="tile-icon tile-icon-finance">
                        <i data-lucide="wallet"></i>
                    </div>
                    <div class="tile-content">
                        <h3>DAF / FinOps</h3>
                        <p>Coûts, budgets, optimisation</p>
                    </div>
                    <i data-lucide="chevron-right" class="tile-arrow"></i>
                </div>
            </div>
        </div>

        <!-- Tech -->
        <div class="persona-category">
            <div class="category-header">
                <span class="category-badge tech">
                    <i data-lucide="cpu"></i>
                    Tech & Sécurité
                </span>
            </div>
            <div class="persona-row">
                <div class="persona-tile" data-persona="tech_ml_engineer" onclick="selectPersona('tech_ml_engineer')">
                    <div class="tile-icon tile-icon-ml">
                        <i data-lucide="brain"></i>
                    </div>
                    <div class="tile-content">
                        <h3>ML Engineer / Data</h3>
                        <p>Drift, modèles, features</p>
                    </div>
                    <i data-lucide="chevron-right" class="tile-arrow"></i>
                </div>
                <div class="persona-tile" data-persona="tech_devops" onclick="selectPersona('tech_devops')">
                    <div class="tile-icon tile-icon-devops">
                        <i data-lucide="server"></i>
                    </div>
                    <div class="tile-content">
                        <h3>DevOps / Platform</h3>
                        <p>SLOs, latences, uptime</p>
                    </div>
                    <i data-lucide="chevron-right" class="tile-arrow"></i>
                </div>
                <div class="persona-tile" data-persona="security_rssi" onclick="selectPersona('security_rssi')">
                    <div class="tile-icon tile-icon-security">
                        <i data-lucide="shield-alert"></i>
                    </div>
                    <div class="tile-content">
                        <h3>RSSI / Security</h3>
                        <p>Menaces, adversarial</p>
                    </div>
                    <i data-lucide="chevron-right" class="tile-arrow"></i>
                </div>
            </div>
        </div>

        <!-- Compliance & ESG -->
        <div class="persona-category">
            <div class="category-header">
                <span class="category-badge compliance">
                    <i data-lucide="scale"></i>
                    Conformité & RSE
                </span>
            </div>
            <div class="persona-row">
                <div class="persona-tile" data-persona="compliance_legal" onclick="selectPersona('compliance_legal')">
                    <div class="tile-icon tile-icon-legal">
                        <i data-lucide="gavel"></i>
                    </div>
                    <div class="tile-content">
                        <h3>DPO / Juriste</h3>
                        <p>EU AI Act, RGPD, audits</p>
                    </div>
                    <i data-lucide="chevron-right" class="tile-arrow"></i>
                </div>
                <div class="persona-tile" data-persona="sustainability_esg" onclick="selectPersona('sustainability_esg')">
                    <div class="tile-icon tile-icon-esg">
                        <i data-lucide="leaf"></i>
                    </div>
                    <div class="tile-content">
                        <h3>RSE / ESG</h3>
                        <p>Carbone, green AI</p>
                    </div>
                    <i data-lucide="chevron-right" class="tile-arrow"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Expert Access -->
    <div class="expert-access">
        <div class="persona-tile expert" data-persona="custom" onclick="selectPersona('custom')">
            <div class="tile-icon tile-icon-expert">
                <i data-lucide="layout-grid"></i>
            </div>
            <div class="tile-content">
                <h3>Accès Expert</h3>
                <p>Toutes les fonctionnalités, navigation libre</p>
            </div>
            <i data-lucide="chevron-right" class="tile-arrow"></i>
        </div>
    </div>

    <!-- Skip Action -->
    <div class="welcome-actions">
        <button class="skip-btn" onclick="skipPersonaSelection()">
            <i data-lucide="arrow-right"></i>
            Passer cette étape
        </button>
        <p class="skip-hint">Accessible depuis <kbd>?</kbd> ou le menu latéral</p>
    </div>

    <!-- Keyboard Shortcuts Hint -->
    <div class="shortcuts-hint">
        <div class="shortcut-item">
            <kbd>1</kbd>-<kbd>7</kbd>
            <span>Sélection rapide</span>
        </div>
        <div class="shortcut-item">
            <kbd>Esc</kbd>
            <span>Passer</span>
        </div>
    </div>
</div>

<style>
/* Welcome Hub - Clean & Focused */
.welcome-hub {
    padding: var(--space-6);
    max-width: 900px;
    margin: 0 auto;
    min-height: calc(100vh - 120px);
    display: flex;
    flex-direction: column;
}

/* Hero - Minimal */
.welcome-hero {
    text-align: center;
    padding: var(--space-4) 0;
    margin-bottom: var(--space-4);
}

.hero-logo {
    width: 56px;
    height: 56px;
    margin: 0 auto var(--space-3);
    background: linear-gradient(135deg, var(--color-or-sahel), var(--color-terre-cuite));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    box-shadow: 0 0 24px rgba(212, 160, 23, 0.25);
}

.hero-logo svg {
    width: 28px;
    height: 28px;
}

.welcome-hero h1 {
    font-size: 1.75rem;
    font-weight: 700;
    margin-bottom: var(--space-2);
    color: var(--text-primary);
    font-family: var(--font-heading);
}

.hero-subtitle {
    font-size: 0.9375rem;
    color: var(--text-secondary);
    line-height: 1.5;
}

.hero-hint {
    display: block;
    margin-top: var(--space-1);
    font-size: 0.8125rem;
    color: var(--text-tertiary);
}

/* Categories */
.persona-categories {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
}

.persona-category {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    overflow: hidden;
}

.category-header {
    padding: var(--space-2) var(--space-4);
    border-bottom: 1px solid var(--border-color);
    background: var(--bg-body);
}

.category-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
}

.category-badge svg {
    width: 14px;
    height: 14px;
}

/* GASKIA Color Palette for Categories */
.category-badge.business {
    background: var(--color-primary-light);
    color: var(--color-or-sahel);
}

.category-badge.tech {
    background: rgba(26, 26, 46, 0.08);
    color: var(--color-bleu-nuit);
}

.category-badge.compliance {
    background: rgba(193, 122, 74, 0.1);
    color: var(--color-terre-cuite);
}

/* Persona Tiles - Compact */
.persona-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
}

.persona-tile {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-4);
    cursor: pointer;
    transition: all 0.2s ease;
    border-bottom: 1px solid var(--border-color);
    border-right: 1px solid var(--border-color);
}

.persona-tile:last-child {
    border-right: none;
}

.persona-row .persona-tile:nth-last-child(-n+3):nth-child(3n+1),
.persona-row .persona-tile:nth-last-child(-n+3):nth-child(3n+1) ~ .persona-tile {
    border-bottom: none;
}

.persona-tile:hover {
    background: var(--bg-body);
}

.persona-tile:hover .tile-arrow {
    transform: translateX(4px);
    opacity: 1;
}

.tile-icon {
    width: 44px;
    height: 44px;
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    flex-shrink: 0;
}

.tile-icon svg {
    width: 22px;
    height: 22px;
}

/* GASKIA Persona Icon Colors */
.tile-icon-business {
    background: linear-gradient(135deg, var(--color-or-sahel), #B8890F);
}

.tile-icon-finance {
    background: linear-gradient(135deg, var(--color-terre-cuite), #A66339);
}

.tile-icon-ml {
    background: linear-gradient(135deg, var(--color-bleu-nuit), #2D2D4A);
}

.tile-icon-devops {
    background: linear-gradient(135deg, #3b5998, #2D4373);
}

.tile-icon-security {
    background: linear-gradient(135deg, #dc3545, #b02a37);
}

.tile-icon-legal {
    background: linear-gradient(135deg, var(--color-terre-cuite), #9A5D3A);
}

.tile-icon-esg {
    background: linear-gradient(135deg, #198754, #146c43);
}

.tile-icon-expert {
    background: linear-gradient(135deg, var(--color-bleu-nuit), var(--color-or-sahel));
}

.tile-content {
    flex: 1;
    min-width: 0;
}

.tile-content h3 {
    font-size: 0.9375rem;
    font-weight: 600;
    margin-bottom: 2px;
    color: var(--text-primary);
}

.tile-content p {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.tile-arrow {
    width: 18px;
    height: 18px;
    color: var(--text-tertiary);
    opacity: 0.5;
    transition: all 0.2s ease;
    flex-shrink: 0;
}

/* Expert Access */
.expert-access {
    margin-top: var(--space-4);
}

.expert-access .persona-tile {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
}

.expert-access .persona-tile.expert {
    border-left: 3px solid var(--color-or-sahel);
}

/* Skip Action */
.welcome-actions {
    text-align: center;
    padding: var(--space-5) 0 var(--space-3);
}

.skip-btn {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-2) var(--space-4);
    background: transparent;
    border: 1px dashed var(--border-color);
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    color: var(--text-tertiary);
    cursor: pointer;
    transition: all 0.2s ease;
}

.skip-btn:hover {
    background: var(--bg-card);
    color: var(--color-or-sahel);
    border-color: var(--color-or-sahel);
    border-style: solid;
}

.skip-btn svg {
    width: 16px;
    height: 16px;
}

.skip-hint {
    margin-top: var(--space-2);
    font-size: 0.75rem;
    color: var(--text-tertiary);
}

.skip-hint kbd {
    padding: 1px 5px;
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    font-size: 0.6875rem;
    font-family: var(--font-body);
}

/* Shortcuts Hint */
.shortcuts-hint {
    display: flex;
    justify-content: center;
    gap: var(--space-6);
    padding: var(--space-4);
    border-top: 1px solid var(--border-color);
    margin-top: auto;
}

.shortcut-item {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: 0.8125rem;
    color: var(--text-tertiary);
}

.shortcut-item kbd {
    padding: 2px 8px;
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    font-size: 0.75rem;
    font-weight: 500;
}

/* Responsive */
@media (max-width: 768px) {
    .welcome-hub {
        padding: var(--space-4);
    }

    .welcome-hero h1 {
        font-size: 1.5rem;
    }

    .persona-row {
        grid-template-columns: 1fr;
    }

    .persona-tile {
        border-right: none;
    }

    .shortcuts-hint {
        flex-direction: column;
        align-items: center;
        gap: var(--space-2);
    }
}

/* Animation on load */
.persona-category {
    animation: fadeInUp 0.4s ease forwards;
    opacity: 0;
}

.persona-category:nth-child(1) { animation-delay: 0.1s; }
.persona-category:nth-child(2) { animation-delay: 0.2s; }
.persona-category:nth-child(3) { animation-delay: 0.3s; }

.expert-access {
    animation: fadeInUp 0.4s ease forwards;
    animation-delay: 0.4s;
    opacity: 0;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>

<script>
// Persona routes mapping
const personaRoutes = {
    'business_executive': '/dirigeant',
    'tech_ml_engineer': '/tech',
    'tech_devops': '/tech',
    'security_rssi': '/tech',
    'compliance_legal': '/juridique',
    'sustainability_esg': '/greenops',
    'financier': '/financier',
    'custom': '/global'
};

// Persona names for display
const personaNames = {
    'business_executive': 'Dirigeant',
    'tech_ml_engineer': 'ML Engineer',
    'tech_devops': 'DevOps',
    'security_rssi': 'Security',
    'compliance_legal': 'Juridique',
    'sustainability_esg': 'ESG',
    'financier': 'Financier',
    'custom': 'Expert'
};

// Select a persona and navigate
function selectPersona(personaId) {
    // Save to localStorage
    localStorage.setItem('gaskia-persona', personaId);
    localStorage.setItem('gaskia-persona-selected', 'true');

    // Show feedback
    if (typeof showToast === 'function') {
        const name = personaNames[personaId] || 'Personnalisé';
        showToast(`Parcours ${name} activé`, 'success', 1500);
    }

    // Navigate after brief delay
    setTimeout(() => {
        window.location.href = personaRoutes[personaId] || '/global';
    }, 300);
}

// Skip persona selection
function skipPersonaSelection() {
    localStorage.setItem('gaskia-persona-skipped', 'true');
    window.location.href = '/dashboard';
}

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
    // Escape to skip
    if (e.key === 'Escape') {
        skipPersonaSelection();
        return;
    }

    // Number keys for quick selection
    const personas = [
        'business_executive',  // 1
        'financier',           // 2
        'tech_ml_engineer',    // 3
        'tech_devops',         // 4
        'security_rssi',       // 5
        'compliance_legal',    // 6
        'sustainability_esg',  // 7
        'custom'               // 8
    ];

    const num = parseInt(e.key);
    if (num >= 1 && num <= personas.length) {
        selectPersona(personas[num - 1]);
    }
});

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    lucide.createIcons();

    // Check if user already has a persona selected
    const existingPersona = localStorage.getItem('gaskia-persona');
    if (existingPersona && localStorage.getItem('gaskia-persona-selected')) {
        // Show subtle indicator that they can continue or change
        const currentName = personaNames[existingPersona] || 'Personnalisé';
        const hint = document.querySelector('.hero-hint');
        if (hint) {
            hint.innerHTML = `Parcours actuel : <strong>${currentName}</strong>. Cliquez pour changer ou <a href="${personaRoutes[existingPersona]}" style="color: var(--color-primary);">continuer</a>.`;
        }
    }
});
</script>
{% endblock %}
