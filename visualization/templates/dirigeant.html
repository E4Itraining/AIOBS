{% extends "base.html" %}

{% set active_page = 'dirigeant' %}

{% block page_title %}Vue Strat√©gique{% endblock %}

{% block content %}
<div class="dirigeant-dashboard page-transition-enter">
    <!-- Hero Section -->
    <div class="dashboard-hero">
        <div class="hero-content">
            <div class="hero-badge" style="background: linear-gradient(135deg, #10b981, #059669);">
                <i data-lucide="building-2"></i>
                <span>Dirigeant / Business</span>
            </div>
            <h1>Vue Strat√©gique</h1>
            <p class="hero-subtitle">
                Pilotez votre portefeuille IA avec une vision 360¬∞. ROI, risques m√©tier, conformit√© et tendances cl√©s.
            </p>
        </div>
        <div class="hero-actions">
            <a href="/global" class="btn btn-outline">
                <i data-lucide="globe"></i>
                <span>Vue Globale</span>
            </a>
            <button class="btn btn-primary" onclick="generateExecutiveReport()">
                <i data-lucide="file-text"></i>
                <span>Rapport Ex√©cutif</span>
            </button>
        </div>
    </div>

    <!-- Executive KPIs -->
    <div class="exec-kpi-grid">
        <div class="exec-kpi-card exec-kpi-highlight">
            <div class="exec-kpi-icon">
                <i data-lucide="trending-up"></i>
            </div>
            <div class="exec-kpi-content">
                <span class="exec-kpi-label">ROI Global IA</span>
                <span class="exec-kpi-value">+247%</span>
                <span class="exec-kpi-trend trend-up">
                    <i data-lucide="arrow-up"></i>
                    +18% vs trimestre pr√©c√©dent
                </span>
            </div>
        </div>

        <div class="exec-kpi-card">
            <div class="exec-kpi-icon" style="background: linear-gradient(135deg, #6366f1, #8b5cf6);">
                <i data-lucide="brain"></i>
            </div>
            <div class="exec-kpi-content">
                <span class="exec-kpi-label">Syst√®mes IA</span>
                <span class="exec-kpi-value">24</span>
                <span class="exec-kpi-trend trend-neutral">
                    <i data-lucide="minus"></i>
                    Portefeuille stable
                </span>
            </div>
        </div>

        <div class="exec-kpi-card">
            <div class="exec-kpi-icon" style="background: linear-gradient(135deg, #10b981, #059669);">
                <i data-lucide="shield-check"></i>
            </div>
            <div class="exec-kpi-content">
                <span class="exec-kpi-label">Score de Confiance</span>
                <span class="exec-kpi-value">87%</span>
                <span class="exec-kpi-trend trend-up">
                    <i data-lucide="arrow-up"></i>
                    +2.3% cette semaine
                </span>
            </div>
        </div>

        <div class="exec-kpi-card">
            <div class="exec-kpi-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                <i data-lucide="alert-triangle"></i>
            </div>
            <div class="exec-kpi-content">
                <span class="exec-kpi-label">Risques Ouverts</span>
                <span class="exec-kpi-value">3</span>
                <span class="exec-kpi-trend trend-warning">
                    <i data-lucide="alert-circle"></i>
                    1 critique, 2 mod√©r√©s
                </span>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="exec-grid">
        <!-- Business Value -->
        <div class="card card-lg">
            <div class="card-header">
                <h3>
                    <i data-lucide="bar-chart-3"></i>
                    Valeur Business G√©n√©r√©e
                </h3>
                <div class="card-header-actions">
                    <div class="time-selector">
                        <button class="time-btn active" data-range="month">Mois</button>
                        <button class="time-btn" data-range="quarter">Trimestre</button>
                        <button class="time-btn" data-range="year">Ann√©e</button>
                    </div>
                    <button class="btn btn-ghost btn-sm" onclick="openBusinessValueDeepDive()">
                        <i data-lucide="maximize-2"></i>
                        Deep Dive
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="value-summary" id="valueSummary">
                    <div class="value-item">
                        <span class="value-number" id="savingsValue">‚Ç¨2.4M</span>
                        <span class="value-label">√âconomies r√©alis√©es</span>
                    </div>
                    <div class="value-item">
                        <span class="value-number" id="revenueValue">‚Ç¨5.7M</span>
                        <span class="value-label">Revenus additionnels</span>
                    </div>
                    <div class="value-item">
                        <span class="value-number" id="productivityValue">34%</span>
                        <span class="value-label">Gain de productivit√©</span>
                    </div>
                </div>
                <div class="chart-container" style="position: relative; height: 250px;">
                    <canvas id="businessValueChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Risk Overview -->
        <div class="card card-lg">
            <div class="card-header">
                <h3>
                    <i data-lucide="shield-alert"></i>
                    Cartographie des Risques
                </h3>
                <a href="/compliance" class="btn btn-ghost btn-sm">
                    D√©tails
                    <i data-lucide="arrow-right"></i>
                </a>
            </div>
            <div class="card-body">
                <div class="risk-matrix" id="riskMatrix">
                    <!-- SVG Risk Matrix -->
                </div>
                <div class="risk-legend">
                    <div class="risk-legend-item">
                        <span class="risk-dot critical"></span>
                        <span>Critique (1)</span>
                    </div>
                    <div class="risk-legend-item">
                        <span class="risk-dot high"></span>
                        <span>√âlev√© (2)</span>
                    </div>
                    <div class="risk-legend-item">
                        <span class="risk-dot medium"></span>
                        <span>Mod√©r√© (4)</span>
                    </div>
                    <div class="risk-legend-item">
                        <span class="risk-dot low"></span>
                        <span>Faible (8)</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Strategic Decisions -->
        <div class="card">
            <div class="card-header">
                <h3>
                    <i data-lucide="lightbulb"></i>
                    Recommandations Strat√©giques
                </h3>
            </div>
            <div class="card-body">
                <div class="recommendations-list">
                    <div class="recommendation-item priority-high">
                        <div class="rec-priority">Urgent</div>
                        <h4>Drift critique sur le scoring cr√©dit</h4>
                        <p>Impact potentiel : ‚Ç¨150K/mois de pertes. Action requise sous 48h.</p>
                        <button class="btn btn-primary btn-sm" onclick="investigateDrift()">
                            Investiguer
                        </button>
                    </div>
                    <div class="recommendation-item priority-medium">
                        <div class="rec-priority">Opportunit√©</div>
                        <h4>Optimisation possible des co√ªts</h4>
                        <p>‚Ç¨45K d'√©conomies mensuelles identifi√©es sur l'infrastructure ML.</p>
                        <button class="btn btn-outline btn-sm">
                            Voir le plan
                        </button>
                    </div>
                    <div class="recommendation-item priority-info">
                        <div class="rec-priority">Info</div>
                        <h4>Nouveau mod√®le pr√™t pour production</h4>
                        <p>NLP-Classifier-v3 a pass√© tous les tests avec un score de 94%.</p>
                        <button class="btn btn-ghost btn-sm">
                            D√©tails
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Conformity Summary -->
        <div class="card">
            <div class="card-header">
                <h3>
                    <i data-lucide="scale"></i>
                    Conformit√© R√©glementaire
                </h3>
                <a href="/juridique" class="btn btn-ghost btn-sm">
                    D√©tails
                    <i data-lucide="arrow-right"></i>
                </a>
            </div>
            <div class="card-body">
                <div class="compliance-gauge">
                    <div class="gauge-container" id="complianceGauge"></div>
                    <div class="gauge-label">
                        <span class="gauge-value">92%</span>
                        <span class="gauge-text">Conformit√© Globale</span>
                    </div>
                </div>
                <div class="compliance-breakdown">
                    <div class="compliance-row">
                        <span class="compliance-name">üá™üá∫ EU AI Act</span>
                        <div class="compliance-mini-bar">
                            <div class="compliance-mini-progress" style="width: 92%;"></div>
                        </div>
                        <span class="compliance-score">92%</span>
                    </div>
                    <div class="compliance-row">
                        <span class="compliance-name">üîí RGPD</span>
                        <div class="compliance-mini-bar">
                            <div class="compliance-mini-progress" style="width: 98%;"></div>
                        </div>
                        <span class="compliance-score">98%</span>
                    </div>
                    <div class="compliance-row">
                        <span class="compliance-name">üõ°Ô∏è S√©curit√©</span>
                        <div class="compliance-mini-bar">
                            <div class="compliance-mini-progress" style="width: 88%;"></div>
                        </div>
                        <span class="compliance-score">88%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cost Overview -->
        <div class="card">
            <div class="card-header">
                <h3>
                    <i data-lucide="wallet"></i>
                    Budget & Co√ªts
                </h3>
                <a href="/financier" class="btn btn-ghost btn-sm">
                    FinOps
                    <i data-lucide="arrow-right"></i>
                </a>
            </div>
            <div class="card-body">
                <div class="budget-overview">
                    <div class="budget-progress">
                        <div class="budget-header">
                            <span>Budget mensuel IA</span>
                            <span>‚Ç¨85K / ‚Ç¨100K</span>
                        </div>
                        <div class="budget-bar">
                            <div class="budget-fill" style="width: 85%;"></div>
                        </div>
                        <div class="budget-status status-ok">
                            <i data-lucide="check-circle"></i>
                            Dans le budget - 15% de marge
                        </div>
                    </div>
                    <div class="budget-breakdown">
                        <div class="budget-item">
                            <span class="budget-category">Inf√©rence</span>
                            <span class="budget-amount">‚Ç¨38K</span>
                        </div>
                        <div class="budget-item">
                            <span class="budget-category">Training</span>
                            <span class="budget-amount">‚Ç¨25K</span>
                        </div>
                        <div class="budget-item">
                            <span class="budget-category">Infrastructure</span>
                            <span class="budget-amount">‚Ç¨22K</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Portfolio -->
        <div class="card">
            <div class="card-header">
                <h3>
                    <i data-lucide="grid-3x3"></i>
                    Portefeuille IA
                </h3>
            </div>
            <div class="card-body">
                <div class="portfolio-grid">
                    <div class="portfolio-item status-operational">
                        <div class="portfolio-icon"><i data-lucide="message-square"></i></div>
                        <span class="portfolio-name">Chatbot Client</span>
                        <span class="portfolio-status">Op√©rationnel</span>
                    </div>
                    <div class="portfolio-item status-operational">
                        <div class="portfolio-icon"><i data-lucide="credit-card"></i></div>
                        <span class="portfolio-name">Scoring Cr√©dit</span>
                        <span class="portfolio-status">Op√©rationnel</span>
                    </div>
                    <div class="portfolio-item status-warning">
                        <div class="portfolio-icon"><i data-lucide="shopping-cart"></i></div>
                        <span class="portfolio-name">Recommandation</span>
                        <span class="portfolio-status">D√©grad√©</span>
                    </div>
                    <div class="portfolio-item status-operational">
                        <div class="portfolio-icon"><i data-lucide="shield"></i></div>
                        <span class="portfolio-name">Fraude Detection</span>
                        <span class="portfolio-status">Op√©rationnel</span>
                    </div>
                    <div class="portfolio-item status-operational">
                        <div class="portfolio-icon"><i data-lucide="file-search"></i></div>
                        <span class="portfolio-name">Doc Analyzer</span>
                        <span class="portfolio-status">Op√©rationnel</span>
                    </div>
                    <div class="portfolio-item status-critical">
                        <div class="portfolio-icon"><i data-lucide="user-check"></i></div>
                        <span class="portfolio-name">KYC Automation</span>
                        <span class="portfolio-status">Critique</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Trend Analysis -->
        <div class="card card-full">
            <div class="card-header">
                <h3>
                    <i data-lucide="line-chart"></i>
                    √âvolution des Indicateurs Cl√©s
                </h3>
                <div class="chart-legend">
                    <span class="legend-item"><span class="legend-color" style="background: #10b981;"></span>Confiance</span>
                    <span class="legend-item"><span class="legend-color" style="background: #6366f1;"></span>Performance</span>
                    <span class="legend-item"><span class="legend-color" style="background: #f59e0b;"></span>Risque</span>
                </div>
            </div>
            <div class="card-body">
                <canvas id="trendAnalysisChart" height="200"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Business Value Deep Dive Modal -->
<div class="modal-overlay" id="businessValueModal">
    <div class="modal-container modal-xl">
        <div class="modal-header">
            <h2>
                <i data-lucide="bar-chart-3"></i>
                Deep Dive - Valeur Business G√©n√©r√©e
            </h2>
            <button class="modal-close" onclick="closeBusinessValueDeepDive()">
                <i data-lucide="x"></i>
            </button>
        </div>
        <div class="modal-body">
            <!-- Time Range Selector -->
            <div class="deep-dive-controls">
                <div class="time-selector-large">
                    <button class="time-btn-lg active" data-range="month">Ce mois</button>
                    <button class="time-btn-lg" data-range="quarter">Ce trimestre</button>
                    <button class="time-btn-lg" data-range="year">Cette ann√©e</button>
                    <button class="time-btn-lg" data-range="all">Historique complet</button>
                </div>
            </div>

            <!-- KPI Cards -->
            <div class="deep-dive-kpis">
                <div class="deep-dive-kpi">
                    <div class="deep-dive-kpi-icon savings">
                        <i data-lucide="piggy-bank"></i>
                    </div>
                    <div class="deep-dive-kpi-content">
                        <span class="deep-dive-kpi-value" id="modalSavings">‚Ç¨2.4M</span>
                        <span class="deep-dive-kpi-label">√âconomies r√©alis√©es</span>
                        <span class="deep-dive-kpi-trend up">
                            <i data-lucide="trending-up"></i>
                            +12% vs p√©riode pr√©c√©dente
                        </span>
                    </div>
                </div>
                <div class="deep-dive-kpi">
                    <div class="deep-dive-kpi-icon revenue">
                        <i data-lucide="banknote"></i>
                    </div>
                    <div class="deep-dive-kpi-content">
                        <span class="deep-dive-kpi-value" id="modalRevenue">‚Ç¨5.7M</span>
                        <span class="deep-dive-kpi-label">Revenus additionnels</span>
                        <span class="deep-dive-kpi-trend up">
                            <i data-lucide="trending-up"></i>
                            +18% vs p√©riode pr√©c√©dente
                        </span>
                    </div>
                </div>
                <div class="deep-dive-kpi">
                    <div class="deep-dive-kpi-icon productivity">
                        <i data-lucide="zap"></i>
                    </div>
                    <div class="deep-dive-kpi-content">
                        <span class="deep-dive-kpi-value" id="modalProductivity">34%</span>
                        <span class="deep-dive-kpi-label">Gain de productivit√©</span>
                        <span class="deep-dive-kpi-trend up">
                            <i data-lucide="trending-up"></i>
                            +5pts vs p√©riode pr√©c√©dente
                        </span>
                    </div>
                </div>
                <div class="deep-dive-kpi">
                    <div class="deep-dive-kpi-icon roi">
                        <i data-lucide="target"></i>
                    </div>
                    <div class="deep-dive-kpi-content">
                        <span class="deep-dive-kpi-value">247%</span>
                        <span class="deep-dive-kpi-label">ROI Global</span>
                        <span class="deep-dive-kpi-trend up">
                            <i data-lucide="trending-up"></i>
                            Objectif : 200%
                        </span>
                    </div>
                </div>
            </div>

            <!-- Charts Grid -->
            <div class="deep-dive-charts">
                <div class="deep-dive-chart-card">
                    <h4>√âvolution mensuelle</h4>
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="deepDiveEvolutionChart"></canvas>
                    </div>
                </div>
                <div class="deep-dive-chart-card">
                    <h4>R√©partition par syst√®me IA</h4>
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="deepDiveDistributionChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Breakdown Table -->
            <div class="deep-dive-table-section">
                <h4>D√©tail par syst√®me IA</h4>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Syst√®me IA</th>
                                <th>√âconomies</th>
                                <th>Revenus</th>
                                <th>Productivit√©</th>
                                <th>ROI</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div class="system-name">
                                        <i data-lucide="message-square"></i>
                                        Chatbot Client
                                    </div>
                                </td>
                                <td>‚Ç¨420K</td>
                                <td>‚Ç¨1.2M</td>
                                <td>+45%</td>
                                <td>312%</td>
                                <td><span class="badge badge-success">Excellent</span></td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="system-name">
                                        <i data-lucide="credit-card"></i>
                                        Scoring Cr√©dit
                                    </div>
                                </td>
                                <td>‚Ç¨850K</td>
                                <td>‚Ç¨2.1M</td>
                                <td>+38%</td>
                                <td>285%</td>
                                <td><span class="badge badge-success">Excellent</span></td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="system-name">
                                        <i data-lucide="shield"></i>
                                        D√©tection Fraude
                                    </div>
                                </td>
                                <td>‚Ç¨680K</td>
                                <td>‚Ç¨1.5M</td>
                                <td>+28%</td>
                                <td>245%</td>
                                <td><span class="badge badge-success">Bon</span></td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="system-name">
                                        <i data-lucide="shopping-cart"></i>
                                        Recommandation
                                    </div>
                                </td>
                                <td>‚Ç¨280K</td>
                                <td>‚Ç¨650K</td>
                                <td>+22%</td>
                                <td>178%</td>
                                <td><span class="badge badge-warning">√Ä surveiller</span></td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="system-name">
                                        <i data-lucide="file-search"></i>
                                        Doc Analyzer
                                    </div>
                                </td>
                                <td>‚Ç¨170K</td>
                                <td>‚Ç¨250K</td>
                                <td>+52%</td>
                                <td>195%</td>
                                <td><span class="badge badge-success">Bon</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeBusinessValueDeepDive()">Fermer</button>
            <button class="btn btn-primary" onclick="exportBusinessValueReport()">
                <i data-lucide="download"></i>
                Exporter le rapport
            </button>
        </div>
    </div>
</div>

<style>
/* Dirigeant Dashboard Styles */
.dirigeant-dashboard {
    padding: var(--space-6);
    max-width: 1600px;
    margin: 0 auto;
}

.dashboard-hero {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-6) 0;
    margin-bottom: var(--space-6);
}

.hero-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-2) var(--space-4);
    color: white;
    border-radius: var(--radius-full);
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: var(--space-3);
}

.hero-badge svg { width: 16px; height: 16px; }

.hero-content h1 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: var(--space-2);
}

.hero-subtitle {
    font-size: 1rem;
    color: var(--text-secondary);
    max-width: 500px;
}

.hero-actions { display: flex; gap: var(--space-3); }

/* Executive KPI Grid */
.exec-kpi-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--space-4);
    margin-bottom: var(--space-8);
}

.exec-kpi-card {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    padding: var(--space-5);
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    transition: all 0.3s ease;
}

.exec-kpi-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
}

.exec-kpi-highlight {
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.05));
    border-color: rgba(16, 185, 129, 0.3);
}

.exec-kpi-icon {
    width: 64px;
    height: 64px;
    background: linear-gradient(135deg, #D4A017, #C17A4A);
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    flex-shrink: 0;
}

.exec-kpi-icon svg { width: 32px; height: 32px; }

.exec-kpi-label {
    font-size: 0.875rem;
    color: var(--text-secondary);
    display: block;
}

.exec-kpi-value {
    font-size: 2rem;
    font-weight: 700;
    display: block;
    margin: var(--space-1) 0;
}

.exec-kpi-trend {
    display: flex;
    align-items: center;
    gap: var(--space-1);
    font-size: 0.75rem;
}

.exec-kpi-trend svg { width: 14px; height: 14px; }

.trend-up { color: #10b981; }
.trend-down { color: #ef4444; }
.trend-neutral { color: var(--text-secondary); }
.trend-warning { color: #f59e0b; }

/* Executive Grid */
.exec-grid {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: var(--space-5);
}

.card { grid-column: span 4; }
.card-lg { grid-column: span 6; }
.card-full { grid-column: span 12; }

/* Card Header Actions */
.card-header-actions {
    display: flex;
    align-items: center;
    gap: var(--space-3);
}

/* Time Selector */
.time-selector {
    display: flex;
    background: var(--bg-body);
    border-radius: var(--radius-md);
    padding: 2px;
}

.time-btn {
    padding: var(--space-2) var(--space-3);
    border: none;
    background: transparent;
    color: var(--text-secondary);
    font-size: 0.75rem;
    font-weight: 500;
    cursor: pointer;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
}

.time-btn:hover {
    color: var(--text-primary);
}

.time-btn.active {
    background: var(--bg-card);
    color: var(--color-primary);
    box-shadow: var(--shadow-sm);
}

/* Value Summary */
.value-summary {
    display: flex;
    justify-content: space-around;
    padding: var(--space-4) 0;
    margin-bottom: var(--space-4);
    border-bottom: 1px solid var(--border-color);
}

.value-item { text-align: center; }

.value-number {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--color-primary);
    display: block;
}

.value-label {
    font-size: 0.875rem;
    color: var(--text-secondary);
}

/* Recommendations */
.recommendations-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
}

.recommendation-item {
    padding: var(--space-4);
    border-radius: var(--radius-md);
    background: var(--bg-body);
}

.rec-priority {
    display: inline-block;
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
    font-size: 0.6875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: var(--space-2);
}

.priority-high .rec-priority {
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
}

.priority-medium .rec-priority {
    background: rgba(245, 158, 11, 0.1);
    color: #f59e0b;
}

.priority-info .rec-priority {
    background: rgba(59, 130, 246, 0.1);
    color: #3b82f6;
}

.recommendation-item h4 {
    font-size: 0.9375rem;
    font-weight: 600;
    margin-bottom: var(--space-1);
}

.recommendation-item p {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    margin-bottom: var(--space-3);
}

/* Compliance Gauge */
.compliance-gauge {
    display: flex;
    align-items: center;
    gap: var(--space-6);
    margin-bottom: var(--space-4);
}

.gauge-container {
    width: 100px;
    height: 100px;
}

.gauge-value {
    font-size: 2rem;
    font-weight: 700;
    color: #10b981;
    display: block;
}

.gauge-text {
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.compliance-breakdown {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
}

.compliance-row {
    display: flex;
    align-items: center;
    gap: var(--space-2);
}

.compliance-name {
    width: 100px;
    font-size: 0.8125rem;
}

.compliance-mini-bar {
    flex: 1;
    height: 6px;
    background: var(--bg-body);
    border-radius: var(--radius-full);
    overflow: hidden;
}

.compliance-mini-progress {
    height: 100%;
    background: linear-gradient(90deg, #D4A017, #10b981);
    border-radius: var(--radius-full);
}

.compliance-score {
    font-size: 0.8125rem;
    font-weight: 600;
    min-width: 35px;
    text-align: right;
}

/* Budget Overview */
.budget-progress {
    margin-bottom: var(--space-4);
}

.budget-header {
    display: flex;
    justify-content: space-between;
    font-size: 0.875rem;
    margin-bottom: var(--space-2);
}

.budget-bar {
    height: 12px;
    background: var(--bg-body);
    border-radius: var(--radius-full);
    overflow: hidden;
    margin-bottom: var(--space-2);
}

.budget-fill {
    height: 100%;
    background: linear-gradient(90deg, #10b981, #059669);
    border-radius: var(--radius-full);
}

.budget-status {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: 0.8125rem;
}

.budget-status svg { width: 14px; height: 14px; }

.status-ok { color: #10b981; }

.budget-breakdown {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    padding-top: var(--space-4);
    border-top: 1px solid var(--border-color);
}

.budget-item {
    display: flex;
    justify-content: space-between;
    font-size: 0.875rem;
}

.budget-amount { font-weight: 600; }

/* Portfolio Grid */
.portfolio-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-3);
}

.portfolio-item {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-3);
    border-radius: var(--radius-md);
    background: var(--bg-body);
}

.portfolio-icon {
    width: 36px;
    height: 36px;
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-primary);
    color: white;
}

.portfolio-icon svg { width: 18px; height: 18px; }

.portfolio-name {
    flex: 1;
    font-size: 0.8125rem;
    font-weight: 500;
}

.portfolio-status {
    font-size: 0.6875rem;
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
}

.status-operational .portfolio-status {
    background: rgba(16, 185, 129, 0.1);
    color: #10b981;
}

.status-warning .portfolio-status {
    background: rgba(245, 158, 11, 0.1);
    color: #f59e0b;
}

.status-critical .portfolio-status {
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
}

/* Risk Legend */
.risk-legend {
    display: flex;
    justify-content: center;
    gap: var(--space-4);
    margin-top: var(--space-4);
}

.risk-legend-item {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: 0.75rem;
}

.risk-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
}

.risk-dot.critical { background: #ef4444; }
.risk-dot.high { background: #f59e0b; }
.risk-dot.medium { background: #3b82f6; }
.risk-dot.low { background: #10b981; }

/* Chart Legend */
.chart-legend {
    display: flex;
    gap: var(--space-4);
}

.legend-item {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: 0.75rem;
}

.legend-color {
    width: 12px;
    height: 12px;
    border-radius: var(--radius-sm);
}

/* Responsive */
@media (max-width: 1400px) {
    .exec-kpi-grid { grid-template-columns: repeat(2, 1fr); }
}

@media (max-width: 1024px) {
    .card-lg { grid-column: span 12; }
    .card { grid-column: span 6; }
}

@media (max-width: 768px) {
    .dashboard-hero { flex-direction: column; text-align: center; gap: var(--space-4); }
    .exec-kpi-grid { grid-template-columns: 1fr; }
    .card { grid-column: span 12; }
    .portfolio-grid { grid-template-columns: 1fr; }
    .card-header-actions { flex-direction: column; align-items: flex-end; gap: var(--space-2); }
}

/* Modal Styles */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--space-4);
    opacity: 0;
    visibility: hidden;
    transition: all var(--transition-base);
}

.modal-overlay.active {
    opacity: 1;
    visibility: visible;
}

.modal-container {
    background: var(--bg-card);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-xl);
    max-height: 90vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transform: scale(0.95) translateY(20px);
    transition: transform var(--transition-base);
}

.modal-overlay.active .modal-container {
    transform: scale(1) translateY(0);
}

.modal-xl {
    width: 100%;
    max-width: 1200px;
}

.modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-5);
    border-bottom: 1px solid var(--border-color);
}

.modal-header h2 {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    font-size: 1.25rem;
    font-weight: 600;
}

.modal-header h2 svg {
    width: 24px;
    height: 24px;
    color: var(--color-primary);
}

.modal-close {
    width: 40px;
    height: 40px;
    border: none;
    background: var(--bg-hover);
    border-radius: var(--radius-md);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-secondary);
    transition: all var(--transition-fast);
}

.modal-close:hover {
    background: var(--color-danger-light);
    color: var(--color-danger);
}

.modal-close svg {
    width: 20px;
    height: 20px;
}

.modal-body {
    padding: var(--space-5);
    overflow-y: auto;
    flex: 1;
}

.modal-footer {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: var(--space-3);
    padding: var(--space-4) var(--space-5);
    border-top: 1px solid var(--border-color);
}

/* Deep Dive Controls */
.deep-dive-controls {
    margin-bottom: var(--space-5);
}

.time-selector-large {
    display: flex;
    background: var(--bg-body);
    border-radius: var(--radius-lg);
    padding: 4px;
    gap: 4px;
}

.time-btn-lg {
    flex: 1;
    padding: var(--space-3) var(--space-4);
    border: none;
    background: transparent;
    color: var(--text-secondary);
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    border-radius: var(--radius-md);
    transition: all var(--transition-fast);
}

.time-btn-lg:hover {
    color: var(--text-primary);
    background: var(--bg-hover);
}

.time-btn-lg.active {
    background: var(--color-primary);
    color: white;
    box-shadow: var(--shadow-md);
}

/* Deep Dive KPIs */
.deep-dive-kpis {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--space-4);
    margin-bottom: var(--space-5);
}

.deep-dive-kpi {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    padding: var(--space-4);
    background: var(--bg-body);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-color);
}

.deep-dive-kpi-icon {
    width: 56px;
    height: 56px;
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.deep-dive-kpi-icon svg {
    width: 28px;
    height: 28px;
    color: white;
}

.deep-dive-kpi-icon.savings {
    background: linear-gradient(135deg, #10b981, #059669);
}

.deep-dive-kpi-icon.revenue {
    background: linear-gradient(135deg, #D4A017, #C17A4A);
}

.deep-dive-kpi-icon.productivity {
    background: linear-gradient(135deg, #6366f1, #8b5cf6);
}

.deep-dive-kpi-icon.roi {
    background: linear-gradient(135deg, #f59e0b, #d97706);
}

.deep-dive-kpi-content {
    display: flex;
    flex-direction: column;
}

.deep-dive-kpi-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
}

.deep-dive-kpi-label {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    margin-bottom: var(--space-1);
}

.deep-dive-kpi-trend {
    display: flex;
    align-items: center;
    gap: var(--space-1);
    font-size: 0.75rem;
    font-weight: 500;
}

.deep-dive-kpi-trend.up {
    color: #10b981;
}

.deep-dive-kpi-trend.down {
    color: #ef4444;
}

.deep-dive-kpi-trend svg {
    width: 14px;
    height: 14px;
}

/* Deep Dive Charts */
.deep-dive-charts {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-4);
    margin-bottom: var(--space-5);
}

.deep-dive-chart-card {
    background: var(--bg-body);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: var(--space-4);
}

.deep-dive-chart-card h4 {
    font-size: 0.9375rem;
    font-weight: 600;
    margin-bottom: var(--space-3);
    color: var(--text-primary);
}

/* Deep Dive Table */
.deep-dive-table-section {
    background: var(--bg-body);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: var(--space-4);
}

.deep-dive-table-section h4 {
    font-size: 0.9375rem;
    font-weight: 600;
    margin-bottom: var(--space-4);
    color: var(--text-primary);
}

.system-name {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-weight: 500;
}

.system-name svg {
    width: 18px;
    height: 18px;
    color: var(--color-primary);
}

/* Responsive Modal */
@media (max-width: 1024px) {
    .deep-dive-kpis { grid-template-columns: repeat(2, 1fr); }
    .deep-dive-charts { grid-template-columns: 1fr; }
}

@media (max-width: 768px) {
    .modal-container { margin: var(--space-2); max-height: 95vh; }
    .deep-dive-kpis { grid-template-columns: 1fr; }
    .time-selector-large { flex-wrap: wrap; }
    .time-btn-lg { flex: 1 1 45%; }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
    lucide.createIcons();
    initDirigeantDashboard();
});

function initDirigeantDashboard() {
    initBusinessValueChart();
    initRiskMatrix();
    initComplianceGauge();
    initTrendAnalysisChart();
}

function initBusinessValueChart() {
    const ctx = document.getElementById('businessValueChart');
    if (!ctx) return;

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Jan', 'F√©v', 'Mar', 'Avr', 'Mai', 'Juin'],
            datasets: [
                {
                    label: '√âconomies',
                    data: [320, 380, 420, 450, 480, 520],
                    backgroundColor: '#10b981',
                    borderRadius: 4
                },
                {
                    label: 'Revenus additionnels',
                    data: [850, 920, 980, 1050, 1100, 1180],
                    backgroundColor: '#D4A017',
                    borderRadius: 4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: { usePointStyle: true }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { callback: v => '‚Ç¨' + v + 'K' }
                }
            }
        }
    });
}

function initRiskMatrix() {
    const container = document.getElementById('riskMatrix');
    if (!container) return;

    // Risk matrix visualization
    container.innerHTML = `
        <svg viewBox="0 0 200 200" style="width: 100%; max-width: 300px; margin: 0 auto; display: block;">
            <!-- Grid -->
            <defs>
                <linearGradient id="riskGradient" x1="0%" y1="100%" x2="100%" y2="0%">
                    <stop offset="0%" style="stop-color:#10b981;stop-opacity:0.2"/>
                    <stop offset="50%" style="stop-color:#f59e0b;stop-opacity:0.2"/>
                    <stop offset="100%" style="stop-color:#ef4444;stop-opacity:0.2"/>
                </linearGradient>
            </defs>
            <rect x="20" y="20" width="160" height="160" fill="url(#riskGradient)" rx="8"/>

            <!-- Axis labels -->
            <text x="100" y="195" text-anchor="middle" font-size="10" fill="var(--text-secondary)">Probabilit√© ‚Üí</text>
            <text x="10" y="100" text-anchor="middle" font-size="10" fill="var(--text-secondary)" transform="rotate(-90 10 100)">Impact ‚Üí</text>

            <!-- Grid lines -->
            <line x1="20" y1="100" x2="180" y2="100" stroke="var(--border-color)" stroke-dasharray="4"/>
            <line x1="100" y1="20" x2="100" y2="180" stroke="var(--border-color)" stroke-dasharray="4"/>

            <!-- Risk points -->
            <circle cx="150" cy="40" r="12" fill="#ef4444" opacity="0.9"/>
            <text x="150" y="44" text-anchor="middle" font-size="8" fill="white" font-weight="bold">1</text>

            <circle cx="130" cy="70" r="10" fill="#f59e0b" opacity="0.9"/>
            <text x="130" y="74" text-anchor="middle" font-size="8" fill="white" font-weight="bold">2</text>

            <circle cx="60" cy="90" r="10" fill="#f59e0b" opacity="0.9"/>
            <text x="60" y="94" text-anchor="middle" font-size="8" fill="white" font-weight="bold">1</text>

            <circle cx="70" cy="130" r="8" fill="#3b82f6" opacity="0.9"/>
            <circle cx="110" cy="120" r="8" fill="#3b82f6" opacity="0.9"/>
            <circle cx="90" cy="145" r="8" fill="#3b82f6" opacity="0.9"/>
            <circle cx="140" cy="135" r="8" fill="#3b82f6" opacity="0.9"/>

            <circle cx="45" cy="155" r="6" fill="#10b981" opacity="0.9"/>
            <circle cx="65" cy="165" r="6" fill="#10b981" opacity="0.9"/>
            <circle cx="85" cy="168" r="6" fill="#10b981" opacity="0.9"/>
            <circle cx="110" cy="160" r="6" fill="#10b981" opacity="0.9"/>
            <circle cx="130" cy="165" r="6" fill="#10b981" opacity="0.9"/>
            <circle cx="150" cy="158" r="6" fill="#10b981" opacity="0.9"/>
            <circle cx="165" cy="165" r="6" fill="#10b981" opacity="0.9"/>
            <circle cx="55" cy="145" r="6" fill="#10b981" opacity="0.9"/>
        </svg>
    `;
}

function initComplianceGauge() {
    const container = document.getElementById('complianceGauge');
    if (!container) return;

    container.innerHTML = `
        <svg viewBox="0 0 100 60" style="width: 100%; height: 100%;">
            <defs>
                <linearGradient id="gaugeGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" style="stop-color:#ef4444"/>
                    <stop offset="50%" style="stop-color:#f59e0b"/>
                    <stop offset="100%" style="stop-color:#10b981"/>
                </linearGradient>
            </defs>
            <path d="M 10 55 A 40 40 0 0 1 90 55" fill="none" stroke="#e5e7eb" stroke-width="8" stroke-linecap="round"/>
            <path d="M 10 55 A 40 40 0 0 1 90 55" fill="none" stroke="url(#gaugeGrad)" stroke-width="8" stroke-linecap="round" stroke-dasharray="126" stroke-dashoffset="10"/>
            <circle cx="82" cy="35" r="4" fill="#10b981"/>
        </svg>
    `;
}

function initTrendAnalysisChart() {
    const ctx = document.getElementById('trendAnalysisChart');
    if (!ctx) return;

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4', 'Sem 5', 'Sem 6', 'Sem 7', 'Sem 8'],
            datasets: [
                {
                    label: 'Confiance',
                    data: [82, 84, 83, 85, 86, 85, 87, 87],
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    fill: false,
                    tension: 0.4
                },
                {
                    label: 'Performance',
                    data: [75, 78, 80, 79, 82, 84, 85, 86],
                    borderColor: '#6366f1',
                    backgroundColor: 'rgba(99, 102, 241, 0.1)',
                    fill: false,
                    tension: 0.4
                },
                {
                    label: 'Risque (invers√©)',
                    data: [70, 72, 75, 73, 78, 80, 82, 85],
                    borderColor: '#f59e0b',
                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                    fill: false,
                    tension: 0.4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    min: 60,
                    max: 100,
                    ticks: { callback: v => v + '%' }
                }
            }
        }
    });
}

function generateExecutiveReport() {
    showToast('G√©n√©ration du rapport ex√©cutif en cours...', 'info', 3000);
}

function investigateDrift() {
    window.location.href = '/causal';
}

// Business Value Data by Time Range
const businessValueData = {
    month: {
        labels: ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4'],
        savings: [580, 620, 590, 610],
        revenue: [1350, 1420, 1380, 1550],
        summaryValues: { savings: '‚Ç¨2.4M', revenue: '‚Ç¨5.7M', productivity: '34%' }
    },
    quarter: {
        labels: ['Jan', 'F√©v', 'Mar'],
        savings: [2100, 2300, 2400],
        revenue: [5200, 5500, 5700],
        summaryValues: { savings: '‚Ç¨6.8M', revenue: '‚Ç¨16.4M', productivity: '32%' }
    },
    year: {
        labels: ['T1', 'T2', 'T3', 'T4'],
        savings: [6200, 6800, 7200, 7800],
        revenue: [15800, 16400, 17200, 18500],
        summaryValues: { savings: '‚Ç¨28M', revenue: '‚Ç¨67.9M', productivity: '38%' }
    }
};

let businessValueChart = null;

// Initialize Time Selector
document.querySelectorAll('.time-selector .time-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        // Update active state
        document.querySelectorAll('.time-selector .time-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');

        // Update chart and values
        const range = this.dataset.range;
        updateBusinessValueChart(range);
    });
});

function updateBusinessValueChart(range) {
    const data = businessValueData[range];
    if (!data) return;

    // Update summary values
    document.getElementById('savingsValue').textContent = data.summaryValues.savings;
    document.getElementById('revenueValue').textContent = data.summaryValues.revenue;
    document.getElementById('productivityValue').textContent = data.summaryValues.productivity;

    // Update chart
    const ctx = document.getElementById('businessValueChart');
    if (!ctx) return;

    if (businessValueChart) {
        businessValueChart.destroy();
    }

    businessValueChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: data.labels,
            datasets: [
                {
                    label: '√âconomies',
                    data: data.savings,
                    backgroundColor: '#10b981',
                    borderRadius: 4
                },
                {
                    label: 'Revenus additionnels',
                    data: data.revenue,
                    backgroundColor: '#D4A017',
                    borderRadius: 4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: { usePointStyle: true }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { callback: v => '‚Ç¨' + v + 'K' }
                }
            }
        }
    });
}

// Deep Dive Modal Functions
let deepDiveEvolutionChart = null;
let deepDiveDistributionChart = null;

function openBusinessValueDeepDive() {
    const modal = document.getElementById('businessValueModal');
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';

    // Initialize charts after modal is visible
    setTimeout(() => {
        lucide.createIcons();
        initDeepDiveCharts();
    }, 100);

    // Initialize time selector in modal
    document.querySelectorAll('.time-selector-large .time-btn-lg').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.time-selector-large .time-btn-lg').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            updateDeepDiveData(this.dataset.range);
        });
    });
}

function closeBusinessValueDeepDive() {
    const modal = document.getElementById('businessValueModal');
    modal.classList.remove('active');
    document.body.style.overflow = '';

    // Destroy charts to prevent memory leaks
    if (deepDiveEvolutionChart) {
        deepDiveEvolutionChart.destroy();
        deepDiveEvolutionChart = null;
    }
    if (deepDiveDistributionChart) {
        deepDiveDistributionChart.destroy();
        deepDiveDistributionChart = null;
    }
}

function initDeepDiveCharts() {
    // Evolution Chart
    const evolutionCtx = document.getElementById('deepDiveEvolutionChart');
    if (evolutionCtx) {
        if (deepDiveEvolutionChart) deepDiveEvolutionChart.destroy();

        deepDiveEvolutionChart = new Chart(evolutionCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'F√©v', 'Mar', 'Avr', 'Mai', 'Juin', 'Juil', 'Ao√ªt', 'Sep', 'Oct', 'Nov', 'D√©c'],
                datasets: [
                    {
                        label: '√âconomies (‚Ç¨K)',
                        data: [180, 220, 280, 320, 380, 420, 450, 480, 520, 560, 590, 620],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'Revenus (‚Ç¨K)',
                        data: [450, 520, 580, 650, 720, 850, 920, 980, 1050, 1100, 1150, 1180],
                        borderColor: '#D4A017',
                        backgroundColor: 'rgba(212, 160, 23, 0.1)',
                        fill: true,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { usePointStyle: true }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { callback: v => '‚Ç¨' + v + 'K' }
                    }
                }
            }
        });
    }

    // Distribution Chart
    const distributionCtx = document.getElementById('deepDiveDistributionChart');
    if (distributionCtx) {
        if (deepDiveDistributionChart) deepDiveDistributionChart.destroy();

        deepDiveDistributionChart = new Chart(distributionCtx, {
            type: 'doughnut',
            data: {
                labels: ['Chatbot Client', 'Scoring Cr√©dit', 'D√©tection Fraude', 'Recommandation', 'Doc Analyzer'],
                datasets: [{
                    data: [1620, 2950, 2180, 930, 420],
                    backgroundColor: [
                        '#10b981',
                        '#D4A017',
                        '#6366f1',
                        '#f59e0b',
                        '#8b5cf6'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            padding: 15
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ‚Ç¨' + context.raw + 'K';
                            }
                        }
                    }
                }
            }
        });
    }
}

function updateDeepDiveData(range) {
    // Update KPI values based on range
    const dataByRange = {
        month: { savings: '‚Ç¨2.4M', revenue: '‚Ç¨5.7M', productivity: '34%' },
        quarter: { savings: '‚Ç¨6.8M', revenue: '‚Ç¨16.4M', productivity: '32%' },
        year: { savings: '‚Ç¨28M', revenue: '‚Ç¨67.9M', productivity: '38%' },
        all: { savings: '‚Ç¨85M', revenue: '‚Ç¨198M', productivity: '35%' }
    };

    const data = dataByRange[range];
    if (data) {
        document.getElementById('modalSavings').textContent = data.savings;
        document.getElementById('modalRevenue').textContent = data.revenue;
        document.getElementById('modalProductivity').textContent = data.productivity;
    }
}

function exportBusinessValueReport() {
    showToast('Export du rapport en cours... Le t√©l√©chargement d√©marrera dans quelques secondes.', 'info', 3000);
}

// Close modal on escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeBusinessValueDeepDive();
    }
});

// Close modal on overlay click
document.getElementById('businessValueModal')?.addEventListener('click', function(e) {
    if (e.target === this) {
        closeBusinessValueDeepDive();
    }
});
</script>
{% endblock %}
